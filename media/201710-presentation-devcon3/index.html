<!DOCTYPE html>
<html lang="en">
  <head>
<meta charset="utf-8" />
<meta
  name="viewport"
  content="width=device-width, initial-scale=1.0, maximum-scale=1.0"
/>
<meta
  name="description"
  content="K Semantics of the Ethereum Virtual Machine (EVM)"
/>
<meta
  name="keywords"
  content="runtime, verification, rv, k, ethereum virtual machine, evm"
/>
<meta name="author" content="EVM Semantics | Runtime Verification Inc" />
<meta name="robots" content="index, follow" />

<!--favicon icon-->
<link rel="icon" type="image/png" href="../../assets/img/favicon.ico" />

<title>KEVM: Semantics of EVM in K | Runtime Verification, Inc. </title>

<link rel="canonical" href="https://jellopaper.org/media/201710-presentation-devcon3/" />

<!--web fonts-->
<link
  href="https://fonts.googleapis.com/css?family=Nunito:300,400,600,700,800"
  rel="stylesheet"
/>
<link
  href="https://fonts.googleapis.com/css?family=Lora:400i"
  rel="stylesheet"
/>

<link
  href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.14.0/css/all.min.css"
  rel="stylesheet"
/>

<link href="../../assets/css/index.css" rel="stylesheet" />

<!--[if (gt IE 9) |!(IE)]><!-->
<!--<link rel="stylesheet" href="/assets/vendor/custom-nav/css/effects/fade-menu.css"/>-->
<!-- <link rel="stylesheet" href="../../assets/k/vl-nav/css/effects/slide-menu.css" /> -->
<!--<![endif]-->

  </head>

  <body>
<header
  class="navbar navbar-expand navbar-dark flex-column flex-md-row bd-navbar"
>
  <a class="logo-link" href="../../index.html"> EVM Semantics </a>
  <ul class="navbar-nav ml-md-auto">
    <li class="nav-item">
      <a
        class="nav-link pl-2 pr-1 mx-1 py-3 my-n2"
        href="https://github.com/kframework/evm-semantics"
        target="_blank"
        rel="noopener"
        aria-label="GitHub"
      >
        <i class="fab fa-github"></i>
      </a>
    </li>
  </ul>
  <!--
  <a
    class="btn btn-rv-blue d-none d-lg-inline-block mb-3 mb-md-0 ml-md-3"
    href="../../downloads"
    >Download</a
  >
  -->
</header>


    <div class="container-fluid">
      <div class="row flex-xl-nowrap">
<div class="col-12 col-md-3 col-xl-2 bd-sidebar mb-3">
  <form
    role="search"
    class="bd-search d-flex align-items-center justify-content-between"
  >
    <input
      type="search"
      class="form-control"
      placeholder="Search..."
      aria-label="Search for..."
      autocomplete="false"
      id="search-box"
    />
    <button
      class="btn bd-search-docs-toggle d-md-none p-0 ml-3 collapsed"
      type="button"
      aria-label="Toggle docs navigation"
      style="font-size: 1.4rem"
    >
      <i class="fas fa-bars"></i>
    </button>
  </form>
  <nav class="collapse bd-links" aria-label="Main navigation">
    <div class="bd-toc-item">
      <a class="bd-toc-link" href="../../">Homepage</a>
      <a class="bd-toc-link" href="../../INSTALL/">Install</a>
    </div>
  </nav>
</div>

        <main
          class="col-12 col-md-6 col-xl-8 py-md-3 pl-md-5 bd-content"
          role="main"
        >
          <div class="markdown-preview"><html><head></head><body><h1 id="evm-words">EVM Words</h1>
<h2 id="utilities">Utilities</h2>
<p>. . .</p>
<h3 id="modulo-arithmetic">Modulo Arithmetic</h3>
<pre class="language-text"><code>    syntax Int ::= chop ( Int ) [function]
 // --------------------------------------
    rule chop ( I:Int ) =&gt; I %Int pow256
      requires I &lt;Int 0  orBool I &gt;=Int pow256

    rule chop ( I:Int ) =&gt; I
      requires I &gt;=Int 0 andBool I &lt;Int pow256
</code></pre>
<p>. . .</p>
<h3 id="word-arithmetic">Word Arithmetic</h3>
<p><code>&lt;op&gt;Word</code> operations incorporate the behavior for EVM arithmetic:</p>
<pre class="language-text"><code>    syntax Int ::= Int &quot;+Word&quot; Int [function]
                 | Int &quot;/Word&quot; Int [function]
 // -----------------------------------------
    rule W0 +Word W1 =&gt; chop( W0 +Int W1 )
    rule W0 /Word 0  =&gt; 0
    rule W0 /Word W1 =&gt; chop( W0 /Int W1 ) requires W1 =/=K 0
</code></pre>
<h1 id="data-structures-over-word">Data-Structures over <code>Word</code></h1>
<h2 id="a-wordstack-for-evm">A WordStack for EVM</h2>
<p>. . .</p>
<h3 id="as-a-cons-list">As a cons-list</h3>
<p>A cons-list is used for the EVM wordstack.</p>
<ul>
<li><code>.WordStack</code> serves as the empty worstack, and</li>
<li><code>_:_</code> serves as the &quot;cons&quot; operator.</li>
</ul>
<pre class="language-text"><code>    syntax WordStack [flatPredicate]
    syntax WordStack ::= &quot;.WordStack&quot; | Int &quot;:&quot; WordStack
 // -----------------------------------------------------
</code></pre>
<p>This can be thought of as a singly linked-list.</p>
<p>. . .</p>
<h3 id="wordstack-append">WordStack Append</h3>
<pre class="language-text"><code>    syntax WordStack ::= WordStack &quot;++&quot; WordStack [function]
 // --------------------------------------------------------
    rule .WordStack ++ WS&apos; =&gt; WS&apos;
    rule (W : WS)   ++ WS&apos; =&gt; W : (WS ++ WS&apos;)
</code></pre>
<h1 id="evm-configuration">EVM Configuration</h1>
<h2 id="keeping-track-of-world-and-vm-state">Keeping Track of World and VM state</h2>
<p>The actual configuration contains <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>60</mn><mo>+</mo></mrow><annotation encoding="application/x-tex">60+</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">60</span><span class="mord">+</span></span></span></span> cells.</p>
<h3 id="vm-execution-state">VM Execution State</h3>
<p>Subconfiguration <code>&lt;evm&gt;</code> contains the execution state of a single VM.</p>
<pre class="language-text"><code>configuration
  &lt;k&gt; $PGM:EthereumSimulation &lt;/k&gt;
  &lt;evm&gt;
    &lt;program&gt;   .Map       &lt;/program&gt;   // I_b
    &lt;wordStack&gt; .WordStack &lt;/wordStack&gt; // \mu_s
    &lt;localMem&gt;  .Map       &lt;/localMem&gt;  // \mu_m
    &lt;gas&gt;       0          &lt;/gas&gt;       // \mu_g
    ...
  &lt;/evm&gt;
  ...
</code></pre>
<h2 id="keeping-track-of-world-and-vm-state-1">Keeping Track of World and VM state</h2>
<h3 id="network%2Fworld-state">Network/World State</h3>
<p>Subconfiguration <code>&lt;network&gt;</code> contains the network/world state.</p>
<ul>
<li><code>multiplicity=&quot;*&quot;</code> allows for multiple co-existing <code>&lt;account&gt;</code> cells.</li>
</ul>
<pre class="language-text"><code>configuration
  ...
  &lt;network&gt;
    &lt;activeAccounts&gt; .Map &lt;/activeAccounts&gt;
    &lt;accounts&gt;
      &lt;account multiplicity=&quot;*&quot; type=&quot;Bag&quot;&gt;
        &lt;acctID&gt;  0          &lt;/acctID&gt;
        &lt;balance&gt; 0          &lt;/balance&gt;
        &lt;code&gt;    .WordStack &lt;/code&gt;
        &lt;storage&gt; .Map       &lt;/storage&gt;
        &lt;nonce&gt;   0          &lt;/nonce&gt;
      &lt;/account&gt;
    &lt;/accounts&gt;
    ...
  &lt;/network&gt;
</code></pre>
<h1 id="evm-execution">EVM Execution</h1>
<h2 id="opcode-execution">OpCode Execution</h2>
<p>. . .</p>
<h3 id="single-step">Single Step</h3>
<p>The <code>#next</code> operator executes a single step by:</p>
<ol>
<li>performing some quick checks for exceptional opcodes,</li>
<li>executes the opcode if it is not immediately exceptional,</li>
<li>increments the program counter, and finally</li>
<li>reverts state if any of the above steps threw an exception.</li>
</ol>
<p>. . .</p>
<pre class="language-text"><code>    rule &lt;mode&gt; EXECMODE &lt;/mode&gt;
         &lt;k&gt; #next
          =&gt; #pushCallStack ~&gt; #exceptional? [ OP ]
                            ~&gt; #exec         [ OP ]
                            ~&gt; #pc           [ OP ]
          ~&gt; #? #dropCallStack : #popCallStack ~&gt; #exception ?#
         ...
         &lt;/k&gt;
         &lt;pc&gt; PCOUNT &lt;/pc&gt;
         &lt;program&gt; ... PCOUNT |-&gt; OP ... &lt;/program&gt;
      requires EXECMODE in (SetItem(NORMAL) SetItem(VMTESTS))
</code></pre>
<h1 id="evm-programs">EVM Programs</h1>
<h2 id="evm-opcodes">EVM OpCodes</h2>
<p>. . .</p>
<h3 id="expressions">Expressions</h3>
<p>Expression opcodes call the corresponding <code>&lt;op&gt;Word</code> operators, then <code>#push</code> the
result:</p>
<pre class="language-text"><code>    syntax BinStackOp ::= &quot;SUB&quot; | &quot;DIV&quot;
 // -----------------------------------
    rule &lt;k&gt; SUB W0 W1 =&gt; W0 -Word W1 ~&gt; #push ... &lt;/k&gt;
    rule &lt;k&gt; DIV W0 W1 =&gt; W0 /Word W1 ~&gt; #push ... &lt;/k&gt;
</code></pre>
<p>. . .</p>
<h3 id="local-memory">Local Memory</h3>
<pre class="language-text"><code>    syntax UnStackOp ::= &quot;MLOAD&quot;
 // ----------------------------
    rule &lt;k&gt; MLOAD INDEX =&gt; #asWord(#range(LM, INDEX, 32)) ~&gt; #push ... &lt;/k&gt;
         &lt;localMem&gt; LM &lt;/localMem&gt;

    syntax BinStackOp ::= &quot;MSTORE&quot;
 // ------------------------------
    rule &lt;k&gt; MSTORE I V =&gt; . ... &lt;/k&gt;
         &lt;localMem&gt; LM =&gt; LM [ I := #padToWidth(32, #asByteStack(V)) ]
         &lt;/localMem&gt;
</code></pre>
<h2 id="ethereum-network-opcodes">Ethereum Network OpCodes</h2>
<p>. . .</p>
<h3 id="account-storage-operations">Account Storage Operations</h3>
<p>These rules reach into the network state and load/store from account storage:</p>
<pre class="language-text"><code>    syntax UnStackOp ::= &quot;SLOAD&quot;
 // ----------------------------
    rule &lt;k&gt; SLOAD INDEX =&gt; VALUE ~&gt; #push ... &lt;/k&gt; &lt;id&gt; ACCT &lt;/id&gt;
         &lt;account&gt;
           &lt;acctID&gt; ACCT &lt;/acctID&gt;
           &lt;storage&gt; ... INDEX |-&gt; VALUE ... &lt;/storage&gt;
           ...
         &lt;/account&gt;
</code></pre>
<p>. . .</p>
<pre class="language-text"><code>    syntax BinStackOp ::= &quot;SSTORE&quot;
 // ------------------------------
    rule &lt;k&gt; SSTORE INDEX VALUE =&gt; . ... &lt;/k&gt; &lt;id&gt; ACCT &lt;/id&gt;
         &lt;account&gt;
           &lt;acctID&gt; ACCT &lt;/acctID&gt;
           &lt;storage&gt; STORAGE =&gt; STORAGE [ INDEX &lt;- VALUE ] &lt;/storage&gt;
           ...
         &lt;/account&gt;
      requires notBool (INDEX in_keys(STORAGE))
</code></pre>
<h2 id="ethereum-network-opcodes-1">Ethereum Network OpCodes</h2>
<p>. . .</p>
<h3 id="call-operations">Call Operations</h3>
<p>For each <code>CALL*</code> operation, we make a corresponding call to <code>#call</code> and a
state-change to setup the custom parts of the calling environment.</p>
<pre class="language-text"><code>    syntax CallOp ::= &quot;CALL&quot;
 // ------------------------
    rule &lt;k&gt; CALL GCAP ACCTTO VALUE ARGSTART ARGWIDTH RETSTART RETWIDTH
          =&gt; #checkCall ACCTFROM VALUE
          ~&gt; #call ACCTFROM ACCTTO ACCTTO Ccallgas(SCHED, ACCTTO, ACCTS, GCAP, GAVAIL, VALUE) VALUE VALUE #range(LM, ARGSTART, ARGWIDTH)
          ~&gt; #return RETSTART RETWIDTH
         ...
         &lt;/k&gt;
         &lt;schedule&gt; SCHED &lt;/schedule&gt;
         &lt;id&gt; ACCTFROM &lt;/id&gt;
         &lt;localMem&gt; LM &lt;/localMem&gt;
         &lt;activeAccounts&gt; ACCTS &lt;/activeAccounts&gt;
         &lt;previousGas&gt; GAVAIL &lt;/previousGas&gt;
</code></pre>
<h1 id="ethereum-gas-calculation">Ethereum Gas Calculation</h1>
<h2 id="execution-gas">Execution Gas</h2>
<p>The intrinsic gas calculation mirrors the style of the YellowPaper (appendix H).</p>
<p>. . .</p>
<h3 id="sstore-gas">SSTORE Gas</h3>
<pre class="language-text"><code>    syntax InternalOp ::= #gasExec ( Schedule , OpCode )
 // ----------------------------------------------------
    rule &lt;k&gt; #gasExec(SCHED, SSTORE INDEX VALUE)
          =&gt; Csstore(SCHED, VALUE, #lookup(STORAGE, INDEX))
         ...
         &lt;/k&gt;
         &lt;id&gt; ACCT &lt;/id&gt;
         &lt;account&gt;
           &lt;acctID&gt; ACCT &lt;/acctID&gt;
           &lt;storage&gt; STORAGE &lt;/storage&gt;
           ...
         &lt;/account&gt;
</code></pre>
<h2 id="gas-calculation-functions">Gas Calculation Functions</h2>
<p>The following functions are defined in the YellowPaper.</p>
<h3 id="csstore">Csstore</h3>
<pre class="language-text"><code>    syntax Int ::= Csstore ( Schedule , Int , Int ) [function]
 // ----------------------------------------------------------
    rule Csstore(SCHED, VALUE, OLD)
      =&gt; #ifInt VALUE =/=Int 0 andBool OLD ==Int 0
            #then Gsstoreset   &lt; SCHED &gt;
            #else Gsstorereset &lt; SCHED &gt;
         #fi
</code></pre>
<p>. . .</p>
<h3 id="others">Others</h3>
<pre class="language-text"><code>    syntax Int ::= Ccall    (Schedule, Int, Map, Int, Int, Int) [function]
                 | Ccallgas (Schedule, Int, Map, Int, Int, Int) [function]
                 | Cgascap  (Schedule, Int, Int, Int)           [function]
                 | Cextra   (Schedule, Int, Map, Int)           [function]
                 | Cxfer    (Schedule, Int)                     [function]
                 | Cnew     (Schedule, Int, Map, Int)           [function]
 // ----------------------------------------------------------------------
</code></pre>
<h2 id="fee-schedule-from-c%2B%2B-implementation">Fee Schedule from C++ Implementation</h2>
<p>. . .</p>
<h3 id="schedule-constants">Schedule Constants</h3>
<p>A <code>ScheduleConst</code> is a constant determined by the fee schedule.</p>
<pre class="language-text"><code>    syntax Int ::= ScheduleConst &quot;&lt;&quot; Schedule &quot;&gt;&quot; [function]

    syntax ScheduleConst ::= &quot;Gzero&quot; | &quot;Gbase&quot; | &quot;Gverylow&quot;
 // -------------------------------------------------------
</code></pre>
<p>. . .</p>
<h3 id="default-schedule">Default Schedule</h3>
<pre class="language-text"><code>    syntax Schedule ::= &quot;DEFAULT&quot;
 // -----------------------------
    rule Gzero &lt; DEFAULT &gt; =&gt; 0
    rule Gbase &lt; DEFAULT &gt; =&gt; 2
</code></pre>
<p>. . .</p>
<h3 id="eip150-schedule">EIP150 Schedule</h3>
<pre class="language-text"><code>    syntax Schedule ::= &quot;EIP150&quot;
 // ----------------------------
    rule Gbalance &lt; EIP150 &gt; =&gt; 400
    rule Gsload   &lt; EIP150 &gt; =&gt; 200
</code></pre>
<h1 id="the-sum-to-n-specification">The Sum To N Specification</h1>
<h2 id="sum-to-n-program-and-claim">Sum To N Program and Claim</h2>
<p>. . .</p>
<h3 id="high-level">High Level</h3>
<p>Canonical &quot;hello world&quot; verification example, in no particular language:</p>
<pre><code>s = 0;
n = N;
while (n &gt; 0) {
    s = s + n;
    n = n - 1;
}
return s;
</code></pre>
<p>. . .</p>
<h3 id="claim">Claim</h3>
<p 2><span style="color: #ee7f49; font-weight: 500;">ParseError: KaTeX parse error: Unexpected end of input in a macro argument, expected &apos;}&apos; at end of input: &#x2026;ac{N * (N + 1)}</span></p>
<h2 id="proof-claims">Proof Claims</h2>
<p>. . .</p>
<h3 id="main-claim">Main Claim</h3>
<ul>
<li>We start at program counter 0 and end at 53.</li>
<li>The <code>&lt;wordStack&gt;</code> starts small enough and ends with the correct sum.</li>
<li>The gas consumed is no more than <code>(52 * N) + 27</code>.</li>
<li><code>N</code> is sufficiently low that overflow will not occur in execution.</li>
</ul>
<p>. . .</p>
<pre class="language-text"><code>     &lt;pc&gt;        0  =&gt; 53                                &lt;/pc&gt;
     &lt;wordStack&gt; WS =&gt; 0 : N *Int (N +Int 1) /Int 2 : WS &lt;/wordStack&gt;
     &lt;gas&gt;       G  =&gt; G -Int (52 *Int N +Int 27)        &lt;/gas&gt;

  requires N &gt;=Int 0
   andBool N &lt;=Int 340282366920938463463374607431768211455
   andBool #sizeWordStack(WS) &lt;Int 1021
   andBool G &gt;=Int 52 *Int N +Int 27
</code></pre>
<h2 id="proof-claims-1">Proof Claims</h2>
<p>. . .</p>
<h3 id="circularity-(loop-invariant)">Circularity (Loop Invariant)</h3>
<p>We specify the behaviour of the rest of the program any time it reaches the loop
head:</p>
<ul>
<li>We start at program counter 35 (beginning of loop) and end at 53.</li>
<li><code>&lt;wordStack&gt;</code> starts with the counter <code>I</code> and the partial sum <code>S</code>, and</li>
<li><code>&lt;wordStack&gt;</code> ends with the correct sum.</li>
<li>The gas consumed for this fragment is no more than <code>(52 * I) + 21</code>.</li>
<li><code>S</code> and <code>I</code> are sufficiently low that overflow will not occur
during execution.</li>
</ul>
<p>. . .</p>
<pre class="language-text"><code>     &lt;pc&gt; 35 =&gt; 53                         &lt;/pc&gt;
     &lt;gas&gt; G =&gt; G -Int (52 *Int I +Int 21) &lt;/gas&gt;

     &lt;wordStack&gt; I : S                               : WS
              =&gt; 0 : S +Int I *Int (I +Int 1) /Int 2 : WS &lt;/wordStack&gt;

  requires I &gt;=Int 0
   andBool S &gt;=Int 0
   andBool S +Int I *Int (I +Int 1) /Int 2 &lt;Int pow256
   andBool #sizeWordStack(WS) &lt;Int 1021
   andBool G &gt;=Int 52 *Int I +Int 21
</code></pre>
<h2 id="verifing-abi-compliant-contracts">Verifing ABI compliant contracts</h2>
<p>. . .</p>
<p><code>#abiCallData</code> generates ABI compliant <code>callData</code>:</p>
<pre class="language-text"><code>    syntax WordStack ::= #abiCallData ( String , TypedArgs ) [function]
 // -------------------------------------------------------------------
    rule #abiCallData( FNAME , ARGS ) =&gt;
        #parseByteStack(substrString(
            Keccak256(#generateSignature(FNAME +String &quot;(&quot;, ARGS)), 0, 8))
            ++ #encodeArgs(.WordStack | ARGS)
</code></pre>
<p>. . .</p>
<p>Here, we generate <code>callData</code> for call the <code>transfer</code> function:</p>
<pre class="language-text"><code>&lt;callData&gt;
    #abiCallData(&quot;transfer&quot;,#address(%ACCOUNT_TO),#uint256(TRANSFER))
&lt;/callData&gt;
</code></pre>
<p>Note that <code>TRANSFER</code> is a symbolic word,</p>
<h2 id="erc20%3A-specifying-transfer">ERC20: Specifying <code>transfer</code></h2>
<p>. . .</p>
<ul>
<li>Execution reaches a <code>RETURN</code> op code</li>
<li>Account balances are updated correctly if balances are sufficient.</li>
</ul>
<pre class="language-text"><code>   &lt;k&gt; #execute =&gt; (RETURN _ _ ~&gt; _) &lt;/k&gt;
   &lt;callData&gt;  #abiCallData(&quot;transfer&quot;, ...) &lt;/callData&gt;
   &lt;accounts&gt;
     &lt;account&gt;
       &lt;storage&gt; (%ACCT_1_BALANCE |-&gt; (B1 =&gt; B1 -Int TRANSFER))
                 (%ACCT_2_BALANCE |-&gt; (B2 =&gt; B2 +Int TRANSFER))
       &lt;/storage&gt;
       ...
     &lt;/account&gt;
   &lt;/accounts&gt;

  requires TRANSFER &gt;Int 0 andBool TRANSFER &lt;Int pow256
   andBool B1 &gt;=Int 0      andBool B1 &lt;Int pow256
   andBool B2 &gt;=Int 0      andBool B2 &lt;Int pow256
   andBool B2 +Int TRANSFER &lt;Int pow256
   andBool B1 -Int TRANSFER &gt;=Int 0
   andBool #sizeWordStack(WS) &lt;Int 1017
</code></pre>
<h1 id="other-work">Other Work</h1>
<h2 id="kevm">KEVM</h2>
<p>Too much to present here (ask offline).</p>
<h3 id="tests">Tests</h3>
<ul>
<li>Pass all of VMTests (deprecated) and GeneralStateTests.</li>
<li>Almost passing BlockchainTests.</li>
<li>Within an order of magnitude the performance of cpp-ethereum.</li>
</ul>
<h3 id="verification">Verification</h3>
<ul>
<li>Verified ERC20 specification over (fixed) HKG Token (see Github repository).</li>
<li>Added ABI-level abstractions for easier specification of proofs (in progress).</li>
</ul>
<h3 id="high-level-languages-(not-discussed-here)">High Level Languages (not discussed here)</h3>
<ul>
<li><code>EVM-PRIME</code> from IC3 Bootcamp.</li>
<li>Extending with more primitives to give semantics to Viper.</li>
</ul>
<h2 id="k-framework">K Framework</h2>
<h3 id="language-independent-pl%2Ffm-toolkit">Language Independent PL/FM Toolkit</h3>
<ul>
<li>Parser/interpreter/debugger/model-checker/verification tools all exist.</li>
<li>Work towards semantics-based compiler (for even better performance).</li>
</ul>
<h3 id="future-directions">Future Directions</h3>
<ul>
<li>More analysis tools built on KEVM.</li>
<li>Other blockchain language semantics in progress.</li>
<li>Other (non-blockchain) language/systems/network semantics in progress.</li>
</ul>
<h1 id="the-end">The End</h1>
<h2 id="acknowledgments">Acknowledgments</h2>
<ul>
<li>Formal Systems Lab (FSL) at UIUC for K support: <a href="http://fsl.cs.illinois.edu" target="_blank" rel="noopener">http://fsl.cs.illinois.edu</a></li>
<li>Runtime Verification, Inc. for K support: <a href="http://runtimeverification.com" target="_blank" rel="noopener">http://runtimeverification.com</a></li>
<li>IOHK for funding and ideas: <a href="http://iohk.io" target="_blank" rel="noopener">http://iohk.io</a></li>
<li>Ethereum Foundation/Devcon3 Teams for hosting: <a href="https://ethereum.org" target="_blank" rel="noopener">https://ethereum.org</a></li>
</ul>
</body></html></div>
        </main>

        <!-- Page ToC -->
        <div class="col-12 col-md-3 col-xl-2 py-md-3 bd-sidebar page-toc mb-3">
          
<div>
<details style="padding:0.25rem 0;;padding-left: 0px;" open>
            <summary class="bd-toc-link-wrapper">
              <a href="#evm-words" class="bd-toc-link">EVM Words</a>
              </summary>
            <div>
              <details style="padding:0.25rem 0;;padding-left: 8px;" open>
            <summary class="bd-toc-link-wrapper">
              <a href="#utilities" class="bd-toc-link">Utilities</a>
              </summary>
            <div>
              <div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#modulo-arithmetic"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                Modulo Arithmetic
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#word-arithmetic"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                Word Arithmetic
              </a></div>
            </div>
          </details>
        
            </div>
          </details>
        <details style="padding:0.25rem 0;;padding-left: 0px;" open>
            <summary class="bd-toc-link-wrapper">
              <a href="#data-structures-over-word" class="bd-toc-link">Data-Structures over <code>Word</code></a>
              </summary>
            <div>
              <details style="padding:0.25rem 0;;padding-left: 8px;" open>
            <summary class="bd-toc-link-wrapper">
              <a href="#a-wordstack-for-evm" class="bd-toc-link">A WordStack for EVM</a>
              </summary>
            <div>
              <div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#as-a-cons-list"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                As a cons-list
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#wordstack-append"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                WordStack Append
              </a></div>
            </div>
          </details>
        
            </div>
          </details>
        <details style="padding:0.25rem 0;;padding-left: 0px;" open>
            <summary class="bd-toc-link-wrapper">
              <a href="#evm-configuration" class="bd-toc-link">EVM Configuration</a>
              </summary>
            <div>
              <details style="padding:0.25rem 0;;padding-left: 8px;" open>
            <summary class="bd-toc-link-wrapper">
              <a href="#keeping-track-of-world-and-vm-state" class="bd-toc-link">Keeping Track of World and VM state</a>
              </summary>
            <div>
              <div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#vm-execution-state"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                VM Execution State
              </a></div>
            </div>
          </details>
        <details style="padding:0.25rem 0;;padding-left: 8px;" open>
            <summary class="bd-toc-link-wrapper">
              <a href="#keeping-track-of-world-and-vm-state-1" class="bd-toc-link">Keeping Track of World and VM state</a>
              </summary>
            <div>
              <div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#network%2Fworld-state"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                Network/World State
              </a></div>
            </div>
          </details>
        
            </div>
          </details>
        <details style="padding:0.25rem 0;;padding-left: 0px;" open>
            <summary class="bd-toc-link-wrapper">
              <a href="#evm-execution" class="bd-toc-link">EVM Execution</a>
              </summary>
            <div>
              <details style="padding:0.25rem 0;;padding-left: 8px;" open>
            <summary class="bd-toc-link-wrapper">
              <a href="#opcode-execution" class="bd-toc-link">OpCode Execution</a>
              </summary>
            <div>
              <div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#single-step"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                Single Step
              </a></div>
            </div>
          </details>
        
            </div>
          </details>
        <details style="padding:0.25rem 0;;padding-left: 0px;" open>
            <summary class="bd-toc-link-wrapper">
              <a href="#evm-programs" class="bd-toc-link">EVM Programs</a>
              </summary>
            <div>
              <details style="padding:0.25rem 0;;padding-left: 8px;" open>
            <summary class="bd-toc-link-wrapper">
              <a href="#evm-opcodes" class="bd-toc-link">EVM OpCodes</a>
              </summary>
            <div>
              <div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#expressions"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                Expressions
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#local-memory"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                Local Memory
              </a></div>
            </div>
          </details>
        <details style="padding:0.25rem 0;;padding-left: 8px;" open>
            <summary class="bd-toc-link-wrapper">
              <a href="#ethereum-network-opcodes" class="bd-toc-link">Ethereum Network OpCodes</a>
              </summary>
            <div>
              <div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#account-storage-operations"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                Account Storage Operations
              </a></div>
            </div>
          </details>
        <details style="padding:0.25rem 0;;padding-left: 8px;" open>
            <summary class="bd-toc-link-wrapper">
              <a href="#ethereum-network-opcodes-1" class="bd-toc-link">Ethereum Network OpCodes</a>
              </summary>
            <div>
              <div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#call-operations"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                Call Operations
              </a></div>
            </div>
          </details>
        
            </div>
          </details>
        <details style="padding:0.25rem 0;;padding-left: 0px;" open>
            <summary class="bd-toc-link-wrapper">
              <a href="#ethereum-gas-calculation" class="bd-toc-link">Ethereum Gas Calculation</a>
              </summary>
            <div>
              <details style="padding:0.25rem 0;;padding-left: 8px;" open>
            <summary class="bd-toc-link-wrapper">
              <a href="#execution-gas" class="bd-toc-link">Execution Gas</a>
              </summary>
            <div>
              <div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#sstore-gas"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                SSTORE Gas
              </a></div>
            </div>
          </details>
        <details style="padding:0.25rem 0;;padding-left: 8px;" open>
            <summary class="bd-toc-link-wrapper">
              <a href="#gas-calculation-functions" class="bd-toc-link">Gas Calculation Functions</a>
              </summary>
            <div>
              <div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#csstore"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                Csstore
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#others"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                Others
              </a></div>
            </div>
          </details>
        <details style="padding:0.25rem 0;;padding-left: 8px;" open>
            <summary class="bd-toc-link-wrapper">
              <a href="#fee-schedule-from-c%2B%2B-implementation" class="bd-toc-link">Fee Schedule from C++ Implementation</a>
              </summary>
            <div>
              <div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#schedule-constants"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                Schedule Constants
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#default-schedule"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                Default Schedule
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#eip150-schedule"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                EIP150 Schedule
              </a></div>
            </div>
          </details>
        
            </div>
          </details>
        <details style="padding:0.25rem 0;;padding-left: 0px;" open>
            <summary class="bd-toc-link-wrapper">
              <a href="#the-sum-to-n-specification" class="bd-toc-link">The Sum To N Specification</a>
              </summary>
            <div>
              <details style="padding:0.25rem 0;;padding-left: 8px;" open>
            <summary class="bd-toc-link-wrapper">
              <a href="#sum-to-n-program-and-claim" class="bd-toc-link">Sum To N Program and Claim</a>
              </summary>
            <div>
              <div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#high-level"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                High Level
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#claim"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                Claim
              </a></div>
            </div>
          </details>
        <details style="padding:0.25rem 0;;padding-left: 8px;" open>
            <summary class="bd-toc-link-wrapper">
              <a href="#proof-claims" class="bd-toc-link">Proof Claims</a>
              </summary>
            <div>
              <div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#main-claim"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                Main Claim
              </a></div>
            </div>
          </details>
        <details style="padding:0.25rem 0;;padding-left: 8px;" open>
            <summary class="bd-toc-link-wrapper">
              <a href="#proof-claims-1" class="bd-toc-link">Proof Claims</a>
              </summary>
            <div>
              <div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#circularity-(loop-invariant)"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                Circularity (Loop Invariant)
              </a></div>
            </div>
          </details>
        <div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#verifing-abi-compliant-contracts"
                class="bd-toc-link"
                style="padding-left: 8px;;"
              >
                Verifing ABI compliant contracts
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#erc20%3A-specifying-transfer"
                class="bd-toc-link"
                style="padding-left: 8px;;"
              >
                ERC20: Specifying <code>transfer</code>
              </a></div>
            </div>
          </details>
        <details style="padding:0.25rem 0;;padding-left: 0px;" open>
            <summary class="bd-toc-link-wrapper">
              <a href="#other-work" class="bd-toc-link">Other Work</a>
              </summary>
            <div>
              <details style="padding:0.25rem 0;;padding-left: 8px;" open>
            <summary class="bd-toc-link-wrapper">
              <a href="#kevm" class="bd-toc-link">KEVM</a>
              </summary>
            <div>
              <div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#tests"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                Tests
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#verification"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                Verification
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#high-level-languages-(not-discussed-here)"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                High Level Languages (not discussed here)
              </a></div>
            </div>
          </details>
        <details style="padding:0.25rem 0;;padding-left: 8px;" open>
            <summary class="bd-toc-link-wrapper">
              <a href="#k-framework" class="bd-toc-link">K Framework</a>
              </summary>
            <div>
              <div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#language-independent-pl%2Ffm-toolkit"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                Language Independent PL/FM Toolkit
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#future-directions"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                Future Directions
              </a></div>
            </div>
          </details>
        
            </div>
          </details>
        <details style="padding:0.25rem 0;;padding-left: 0px;" open>
            <summary class="bd-toc-link-wrapper">
              <a href="#the-end" class="bd-toc-link">The End</a>
              </summary>
            <div>
              <div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#acknowledgments"
                class="bd-toc-link"
                style="padding-left: 8px;;"
              >
                Acknowledgments
              </a></div>
            </div>
          </details>
        
</div>

        </div>
        <div class="btn btn-rv-blue page-toc-toggle-btn"></div>
        <!-- End Page ToC -->
      </div>
    </div>
<!-- The footer is now controlled by the k-web-theme git submodule -->
<footer id="rvsite-footer" class="app-footer text-md-left text-center">
  <div class="container">
    <div class="row align-items-center">
      <div class="col-md-4 mb-md-0 mb-4">
        <a href="https://runtimeverification.com/" target="_blank">
          <picture>
            <source
              srcset="
                https://runtimeverification.com/assets/img/rv-logo-dark.png
              "
              media="(prefers-color-scheme: dark)"
            />
            <img
              class="logo-dark"
              src="https://runtimeverification.com/assets/img/rv-logo.png"
              alt="Runtime Verification logo"
              style="height: 32px"
            /> </picture
        ></a>
        <p class="mt-2 text-md-left copyright">
          <a href="https://goo.gl/maps/NYzr2iKpXMgEmQ2F6" target="_blank"
            >102 E Main St #500, Urbana, IL 61801</a
          >
        </p>
      </div>
      <div class="col-md-4 text-md-center mb-md-0 mb-4"></div>
      <div class="col-md-4 mb-md-0 mb-4 text-md-right">
        <p class="copyright">2021 © all rights reserved</p>
      </div>
    </div>
  </div>
</footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/Typist/1.2/typist.min.js"></script>
    <script src="../../assets/js/index.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script
  async
  src="https://www.googletagmanager.com/gtag/js?id=G-QL0D8HRYFW"
></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag() {
    dataLayer.push(arguments);
  }
  gtag("js", new Date());
  gtag("config", "G-QL0D8HRYFW");
</script>

  </body>
</html>
