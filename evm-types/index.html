<!DOCTYPE html>
<html lang="en">
  <head>
<meta charset="utf-8" />
<meta
  name="viewport"
  content="width=device-width, initial-scale=1.0, maximum-scale=1.0"
/>
<meta
  name="description"
  content="K Semantics of the Ethereum Virtual Machine (EVM)"
/>
<meta
  name="keywords"
  content="runtime, verification, rv, k, ethereum virtual machine, evm"
/>
<meta name="author" content="EVM Semantics | Runtime Verification Inc" />
<meta name="robots" content="index, follow" />

<!--favicon icon-->
<link rel="icon" type="image/png" href="../assets/img/favicon.ico" />

<title>KEVM: Semantics of EVM in K | Runtime Verification, Inc. </title>

<link rel="canonical" href="https://jellopaper.org/evm-types/" />

<!--web fonts-->
<link
  href="https://fonts.googleapis.com/css?family=Nunito:300,400,600,700,800"
  rel="stylesheet"
/>
<link
  href="https://fonts.googleapis.com/css?family=Lora:400i"
  rel="stylesheet"
/>

<link
  href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.14.0/css/all.min.css"
  rel="stylesheet"
/>

<link href="../assets/css/index.css" rel="stylesheet" />

<!--[if (gt IE 9) |!(IE)]><!-->
<!--<link rel="stylesheet" href="/assets/vendor/custom-nav/css/effects/fade-menu.css"/>-->
<!-- <link rel="stylesheet" href="../assets/k/vl-nav/css/effects/slide-menu.css" /> -->
<!--<![endif]-->

  </head>

  <body>
<header
  class="navbar navbar-expand navbar-dark flex-column flex-md-row bd-navbar"
>
  <a class="logo-link" href="../index.html"> EVM Semantics </a>
  <ul class="navbar-nav ml-md-auto">
    <li class="nav-item">
      <a
        class="nav-link pl-2 pr-1 mx-1 py-3 my-n2"
        href="https://github.com/kframework/evm-semantics"
        target="_blank"
        rel="noopener"
        aria-label="GitHub"
      >
        <i class="fab fa-github"></i>
      </a>
    </li>
  </ul>
  <!--
  <a
    class="btn btn-rv-blue d-none d-lg-inline-block mb-3 mb-md-0 ml-md-3"
    href="../downloads"
    >Download</a
  >
  -->
</header>


    <div class="container-fluid">
      <div class="row flex-xl-nowrap">
<div class="col-12 col-md-3 col-xl-2 bd-sidebar mb-3">
  <form
    role="search"
    class="bd-search d-flex align-items-center justify-content-between"
  >
    <input
      type="search"
      class="form-control"
      placeholder="Search..."
      aria-label="Search for..."
      autocomplete="false"
      id="search-box"
    />
    <button
      class="btn bd-search-docs-toggle d-md-none p-0 ml-3 collapsed"
      type="button"
      aria-label="Toggle docs navigation"
      style="font-size: 1.4rem"
    >
      <i class="fas fa-bars"></i>
    </button>
  </form>
  <nav class="collapse bd-links" aria-label="Main navigation">
    <div class="bd-toc-item">
      <a class="bd-toc-link" href="../">Homepage</a>
      <a class="bd-toc-link" href="../INSTALL/">Install</a>
    </div>
  </nav>
</div>

        <main
          class="col-12 col-md-6 col-xl-8 py-md-3 pl-md-5 bd-content"
          role="main"
        >
          <div class="markdown-preview"><html><head></head><body><h1 id="data-structures-over-word">Data-Structures over <code>Word</code></h1>
<p>EVM uses bounded 256 bit integer words, and sometimes also bytes (8 bit words).
Here we provide the arithmetic of these words, as well as some data-structures over them.
Both are implemented using K&apos;s <code>Int</code>.</p>
<pre class="language-k"><code><span class="token keyword">module</span> EVM<span class="token operator">-</span>TYPES
    <span class="token keyword">imports</span> INT
    <span class="token keyword">imports</span> STRING
    <span class="token keyword">imports</span> COLLECTIONS
    <span class="token keyword">imports</span> BOOL
    <span class="token keyword">imports</span> K<span class="token operator">-</span>EQUAL
</code></pre>
<pre class="language-text"><code>    imports BYTES
</code></pre>
<h2 id="utilities">Utilities</h2>
<h3 id="important-powers">Important Powers</h3>
<p>Some important numbers that are referred to often during execution.
These can be used for pattern-matching on the LHS of rules as well (<code>macro</code> attribute expands all occurances of these in rules).</p>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> <span class="token keyword">Int</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;pow256&quot;</span> <span class="token punctuation">[</span><span class="token class-name">macro</span><span class="token punctuation">]</span> <span class="token comment">/* 2 ^Int 256 */</span>
                 <span class="token operator">|</span> <span class="token string">&quot;pow255&quot;</span> <span class="token punctuation">[</span><span class="token class-name">macro</span><span class="token punctuation">]</span> <span class="token comment">/* 2 ^Int 255 */</span>
                 <span class="token operator">|</span> <span class="token string">&quot;pow224&quot;</span> <span class="token punctuation">[</span><span class="token class-name">macro</span><span class="token punctuation">]</span> <span class="token comment">/* 2 ^Int 224 */</span>
                 <span class="token operator">|</span> <span class="token string">&quot;pow208&quot;</span> <span class="token punctuation">[</span><span class="token class-name">macro</span><span class="token punctuation">]</span> <span class="token comment">/* 2 ^Int 208 */</span>
                 <span class="token operator">|</span> <span class="token string">&quot;pow168&quot;</span> <span class="token punctuation">[</span><span class="token class-name">macro</span><span class="token punctuation">]</span> <span class="token comment">/* 2 ^Int 168 */</span>
                 <span class="token operator">|</span> <span class="token string">&quot;pow160&quot;</span> <span class="token punctuation">[</span><span class="token class-name">macro</span><span class="token punctuation">]</span> <span class="token comment">/* 2 ^Int 160 */</span>
                 <span class="token operator">|</span> <span class="token string">&quot;pow128&quot;</span> <span class="token punctuation">[</span><span class="token class-name">macro</span><span class="token punctuation">]</span> <span class="token comment">/* 2 ^Int 128 */</span>
                 <span class="token operator">|</span> <span class="token string">&quot;pow96&quot;</span>  <span class="token punctuation">[</span><span class="token class-name">macro</span><span class="token punctuation">]</span> <span class="token comment">/* 2 ^Int 96  */</span>
                 <span class="token operator">|</span> <span class="token string">&quot;pow48&quot;</span>  <span class="token punctuation">[</span><span class="token class-name">macro</span><span class="token punctuation">]</span> <span class="token comment">/* 2 ^Int 48  */</span>
                 <span class="token operator">|</span> <span class="token string">&quot;pow16&quot;</span>  <span class="token punctuation">[</span><span class="token class-name">macro</span><span class="token punctuation">]</span> <span class="token comment">/* 2 ^Int 16  */</span>
 <span class="token comment">// ------------------------------------------------</span>
    <span class="token keyword">rule</span> pow256 <span class="token operator">=&gt;</span> <span class="token number">115792089237316195423570985008687907853269984665640564039457584007913129639936</span>
    <span class="token keyword">rule</span> pow255 <span class="token operator">=&gt;</span> <span class="token number">57896044618658097711785492504343953926634992332820282019728792003956564819968</span>
    <span class="token keyword">rule</span> pow224 <span class="token operator">=&gt;</span> <span class="token number">26959946667150639794667015087019630673637144422540572481103610249216</span>
    <span class="token keyword">rule</span> pow208 <span class="token operator">=&gt;</span> <span class="token number">411376139330301510538742295639337626245683966408394965837152256</span>
    <span class="token keyword">rule</span> pow168 <span class="token operator">=&gt;</span> <span class="token number">374144419156711147060143317175368453031918731001856</span>
    <span class="token keyword">rule</span> pow160 <span class="token operator">=&gt;</span> <span class="token number">1461501637330902918203684832716283019655932542976</span>
    <span class="token keyword">rule</span> pow128 <span class="token operator">=&gt;</span> <span class="token number">340282366920938463463374607431768211456</span>
    <span class="token keyword">rule</span> pow96  <span class="token operator">=&gt;</span> <span class="token number">79228162514264337593543950336</span>
    <span class="token keyword">rule</span> pow48  <span class="token operator">=&gt;</span> <span class="token number">281474976710656</span>
    <span class="token keyword">rule</span> pow16  <span class="token operator">=&gt;</span> <span class="token number">65536</span>

    <span class="token keyword">syntax</span> <span class="token keyword">Int</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;minSInt128&quot;</span>      <span class="token punctuation">[</span><span class="token class-name">macro</span><span class="token punctuation">]</span>
                 <span class="token operator">|</span> <span class="token string">&quot;maxSInt128&quot;</span>      <span class="token punctuation">[</span><span class="token class-name">macro</span><span class="token punctuation">]</span>
                 <span class="token operator">|</span> <span class="token string">&quot;minUInt8&quot;</span>        <span class="token punctuation">[</span><span class="token class-name">macro</span><span class="token punctuation">]</span>
                 <span class="token operator">|</span> <span class="token string">&quot;maxUInt8&quot;</span>        <span class="token punctuation">[</span><span class="token class-name">macro</span><span class="token punctuation">]</span>
                 <span class="token operator">|</span> <span class="token string">&quot;minUInt16&quot;</span>       <span class="token punctuation">[</span><span class="token class-name">macro</span><span class="token punctuation">]</span>
                 <span class="token operator">|</span> <span class="token string">&quot;maxUInt16&quot;</span>       <span class="token punctuation">[</span><span class="token class-name">macro</span><span class="token punctuation">]</span>
                 <span class="token operator">|</span> <span class="token string">&quot;minUInt48&quot;</span>       <span class="token punctuation">[</span><span class="token class-name">macro</span><span class="token punctuation">]</span>
                 <span class="token operator">|</span> <span class="token string">&quot;maxUInt48&quot;</span>       <span class="token punctuation">[</span><span class="token class-name">macro</span><span class="token punctuation">]</span>
                 <span class="token operator">|</span> <span class="token string">&quot;minUInt96&quot;</span>       <span class="token punctuation">[</span><span class="token class-name">macro</span><span class="token punctuation">]</span>
                 <span class="token operator">|</span> <span class="token string">&quot;maxUInt96&quot;</span>       <span class="token punctuation">[</span><span class="token class-name">macro</span><span class="token punctuation">]</span>
                 <span class="token operator">|</span> <span class="token string">&quot;minUInt128&quot;</span>      <span class="token punctuation">[</span><span class="token class-name">macro</span><span class="token punctuation">]</span>
                 <span class="token operator">|</span> <span class="token string">&quot;maxUInt128&quot;</span>      <span class="token punctuation">[</span><span class="token class-name">macro</span><span class="token punctuation">]</span>
                 <span class="token operator">|</span> <span class="token string">&quot;minUInt160&quot;</span>      <span class="token punctuation">[</span><span class="token class-name">macro</span><span class="token punctuation">]</span>
                 <span class="token operator">|</span> <span class="token string">&quot;maxUInt160&quot;</span>      <span class="token punctuation">[</span><span class="token class-name">macro</span><span class="token punctuation">]</span>
                 <span class="token operator">|</span> <span class="token string">&quot;minUInt168&quot;</span>      <span class="token punctuation">[</span><span class="token class-name">macro</span><span class="token punctuation">]</span>
                 <span class="token operator">|</span> <span class="token string">&quot;maxUInt168&quot;</span>      <span class="token punctuation">[</span><span class="token class-name">macro</span><span class="token punctuation">]</span>
                 <span class="token operator">|</span> <span class="token string">&quot;minUInt208&quot;</span>      <span class="token punctuation">[</span><span class="token class-name">macro</span><span class="token punctuation">]</span>
                 <span class="token operator">|</span> <span class="token string">&quot;maxUInt208&quot;</span>      <span class="token punctuation">[</span><span class="token class-name">macro</span><span class="token punctuation">]</span>
                 <span class="token operator">|</span> <span class="token string">&quot;minUInt224&quot;</span>      <span class="token punctuation">[</span><span class="token class-name">macro</span><span class="token punctuation">]</span>
                 <span class="token operator">|</span> <span class="token string">&quot;maxUInt224&quot;</span>      <span class="token punctuation">[</span><span class="token class-name">macro</span><span class="token punctuation">]</span>
                 <span class="token operator">|</span> <span class="token string">&quot;minSInt256&quot;</span>      <span class="token punctuation">[</span><span class="token class-name">macro</span><span class="token punctuation">]</span>
                 <span class="token operator">|</span> <span class="token string">&quot;maxSInt256&quot;</span>      <span class="token punctuation">[</span><span class="token class-name">macro</span><span class="token punctuation">]</span>
                 <span class="token operator">|</span> <span class="token string">&quot;minUInt256&quot;</span>      <span class="token punctuation">[</span><span class="token class-name">macro</span><span class="token punctuation">]</span>
                 <span class="token operator">|</span> <span class="token string">&quot;maxUInt256&quot;</span>      <span class="token punctuation">[</span><span class="token class-name">macro</span><span class="token punctuation">]</span>
                 <span class="token operator">|</span> <span class="token string">&quot;minSFixed128x10&quot;</span> <span class="token punctuation">[</span><span class="token class-name">macro</span><span class="token punctuation">]</span>
                 <span class="token operator">|</span> <span class="token string">&quot;maxSFixed128x10&quot;</span> <span class="token punctuation">[</span><span class="token class-name">macro</span><span class="token punctuation">]</span>
                 <span class="token operator">|</span> <span class="token string">&quot;minUFixed128x10&quot;</span> <span class="token punctuation">[</span><span class="token class-name">macro</span><span class="token punctuation">]</span>
                 <span class="token operator">|</span> <span class="token string">&quot;maxUFixed128x10&quot;</span> <span class="token punctuation">[</span><span class="token class-name">macro</span><span class="token punctuation">]</span>
 <span class="token comment">// ----------------------------------------</span>
    <span class="token keyword">rule</span> minSInt128      <span class="token operator">=&gt;</span> <span class="token operator">-</span><span class="token number">170141183460469231731687303715884105728</span>                                        <span class="token comment">/*  -2^127      */</span>
    <span class="token keyword">rule</span> maxSInt128      <span class="token operator">=&gt;</span>  <span class="token number">170141183460469231731687303715884105727</span>                                        <span class="token comment">/*   2^127 - 1  */</span>
    <span class="token keyword">rule</span> minSFixed128x10 <span class="token operator">=&gt;</span> <span class="token operator">-</span><span class="token number">1701411834604692317316873037158841057280000000000</span>                              <span class="token comment">/* (-2^127    ) * 10^10 */</span>
    <span class="token keyword">rule</span> maxSFixed128x10 <span class="token operator">=&gt;</span>  <span class="token number">1701411834604692317316873037158841057270000000000</span>                              <span class="token comment">/* ( 2^127 - 1) * 10^10 */</span>
    <span class="token keyword">rule</span> minSInt256      <span class="token operator">=&gt;</span> <span class="token operator">-</span><span class="token number">57896044618658097711785492504343953926634992332820282019728792003956564819968</span>  <span class="token comment">/*  -2^255      */</span>
    <span class="token keyword">rule</span> maxSInt256      <span class="token operator">=&gt;</span>  <span class="token number">57896044618658097711785492504343953926634992332820282019728792003956564819967</span>  <span class="token comment">/*   2^255 - 1  */</span>

    <span class="token keyword">rule</span> minUInt8        <span class="token operator">=&gt;</span>  <span class="token number">0</span>
    <span class="token keyword">rule</span> maxUInt8        <span class="token operator">=&gt;</span>  <span class="token number">255</span>
    <span class="token keyword">rule</span> minUInt16       <span class="token operator">=&gt;</span>  <span class="token number">0</span>
    <span class="token keyword">rule</span> maxUInt16       <span class="token operator">=&gt;</span>  <span class="token number">65535</span>                                                                          <span class="token comment">/*   2^16 -  1  */</span>
    <span class="token keyword">rule</span> minUInt48       <span class="token operator">=&gt;</span>  <span class="token number">0</span>
    <span class="token keyword">rule</span> maxUInt48       <span class="token operator">=&gt;</span>  <span class="token number">281474976710655</span>                                                                <span class="token comment">/*   2^48 -  1  */</span>
    <span class="token keyword">rule</span> minUInt96       <span class="token operator">=&gt;</span>  <span class="token number">0</span>
    <span class="token keyword">rule</span> maxUInt96       <span class="token operator">=&gt;</span>  <span class="token number">79228162514264337593543950335</span>                                                  <span class="token comment">/*   2^96 -  1  */</span>
    <span class="token keyword">rule</span> minUInt128      <span class="token operator">=&gt;</span>  <span class="token number">0</span>
    <span class="token keyword">rule</span> maxUInt128      <span class="token operator">=&gt;</span>  <span class="token number">340282366920938463463374607431768211455</span>                                        <span class="token comment">/*   2^128 - 1  */</span>
    <span class="token keyword">rule</span> minUFixed128x10 <span class="token operator">=&gt;</span>  <span class="token number">0</span>
    <span class="token keyword">rule</span> maxUFixed128x10 <span class="token operator">=&gt;</span>  <span class="token number">3402823669209384634633746074317682114550000000000</span>                              <span class="token comment">/* ( 2^128 - 1) * 10^10 */</span>
    <span class="token keyword">rule</span> minUInt160      <span class="token operator">=&gt;</span>  <span class="token number">0</span>
    <span class="token keyword">rule</span> maxUInt160      <span class="token operator">=&gt;</span>  <span class="token number">1461501637330902918203684832716283019655932542975</span>                              <span class="token comment">/*   2^160 - 1  */</span>
    <span class="token keyword">rule</span> minUInt168      <span class="token operator">=&gt;</span>  <span class="token number">0</span>
    <span class="token keyword">rule</span> maxUInt168      <span class="token operator">=&gt;</span>  <span class="token number">374144419156711147060143317175368453031918731001855</span>                            <span class="token comment">/*   2^168 - 1  */</span>
    <span class="token keyword">rule</span> minUInt208      <span class="token operator">=&gt;</span>  <span class="token number">0</span>
    <span class="token keyword">rule</span> maxUInt208      <span class="token operator">=&gt;</span>  <span class="token number">411376139330301510538742295639337626245683966408394965837152255</span>                <span class="token comment">/*   2^208 - 1  */</span>
    <span class="token keyword">rule</span> minUInt224      <span class="token operator">=&gt;</span>  <span class="token number">0</span>
    <span class="token keyword">rule</span> maxUInt224      <span class="token operator">=&gt;</span>  <span class="token number">26959946667150639794667015087019630673637144422540572481103610249215</span>           <span class="token comment">/*   2^224 - 1  */</span>
    <span class="token keyword">rule</span> minUInt256      <span class="token operator">=&gt;</span>  <span class="token number">0</span>
    <span class="token keyword">rule</span> maxUInt256      <span class="token operator">=&gt;</span>  <span class="token number">115792089237316195423570985008687907853269984665640564039457584007913129639935</span> <span class="token comment">/*   2^256 - 1  */</span>

    <span class="token keyword">syntax</span> <span class="token keyword">Int</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;eth&quot;</span> <span class="token punctuation">[</span><span class="token class-name">macro</span><span class="token punctuation">]</span>
 <span class="token comment">// ----------------------------</span>
    <span class="token keyword">rule</span> eth <span class="token operator">=&gt;</span> <span class="token number">1000000000000000000</span>
</code></pre>
<ul>
<li>Range of types</li>
</ul>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> <span class="token keyword">Bool</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #rangeBool    <span class="token punctuation">(</span> <span class="token keyword">Int</span> <span class="token punctuation">)</span>             <span class="token punctuation">[</span><span class="token class-name">macro</span><span class="token punctuation">]</span>
                  <span class="token operator">|</span> #rangeSInt    <span class="token punctuation">(</span> <span class="token keyword">Int</span> <span class="token punctuation">,</span> <span class="token keyword">Int</span> <span class="token punctuation">)</span>       <span class="token punctuation">[</span><span class="token class-name">macro</span><span class="token punctuation">]</span>
                  <span class="token operator">|</span> #rangeUInt    <span class="token punctuation">(</span> <span class="token keyword">Int</span> <span class="token punctuation">,</span> <span class="token keyword">Int</span> <span class="token punctuation">)</span>       <span class="token punctuation">[</span><span class="token class-name">macro</span><span class="token punctuation">]</span>
                  <span class="token operator">|</span> #rangeSFixed  <span class="token punctuation">(</span> <span class="token keyword">Int</span> <span class="token punctuation">,</span> <span class="token keyword">Int</span> <span class="token punctuation">,</span> <span class="token keyword">Int</span> <span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token class-name">macro</span><span class="token punctuation">]</span>
                  <span class="token operator">|</span> #rangeUFixed  <span class="token punctuation">(</span> <span class="token keyword">Int</span> <span class="token punctuation">,</span> <span class="token keyword">Int</span> <span class="token punctuation">,</span> <span class="token keyword">Int</span> <span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token class-name">macro</span><span class="token punctuation">]</span>
                  <span class="token operator">|</span> #rangeAddress <span class="token punctuation">(</span> <span class="token keyword">Int</span> <span class="token punctuation">)</span>             <span class="token punctuation">[</span><span class="token class-name">macro</span><span class="token punctuation">]</span>
                  <span class="token operator">|</span> #rangeBytes   <span class="token punctuation">(</span> <span class="token keyword">Int</span> <span class="token punctuation">,</span> <span class="token keyword">Int</span> <span class="token punctuation">)</span>       <span class="token punctuation">[</span><span class="token class-name">macro</span><span class="token punctuation">]</span>
 <span class="token comment">// ---------------------------------------------------------</span>
    <span class="token keyword">rule</span> #rangeBool    <span class="token punctuation">(</span>            X <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> X <span class="token operator">==</span><span class="token keyword">Int</span> <span class="token number">0</span> orBool X <span class="token operator">==</span><span class="token keyword">Int</span> <span class="token number">1</span>
    <span class="token keyword">rule</span> #rangeSInt    <span class="token punctuation">(</span> <span class="token number">128</span> <span class="token punctuation">,</span>      X <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #range <span class="token punctuation">(</span> minSInt128      <span class="token operator">&lt;=</span> X <span class="token operator">&lt;=</span> maxSInt128      <span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #rangeSInt    <span class="token punctuation">(</span> <span class="token number">256</span> <span class="token punctuation">,</span>      X <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #range <span class="token punctuation">(</span> minSInt256      <span class="token operator">&lt;=</span> X <span class="token operator">&lt;=</span> maxSInt256      <span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #rangeUInt    <span class="token punctuation">(</span>   <span class="token number">8</span> <span class="token punctuation">,</span>      X <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #range <span class="token punctuation">(</span> minUInt8        <span class="token operator">&lt;=</span> X &lt;  <span class="token number">256</span>             <span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #rangeUInt    <span class="token punctuation">(</span>  <span class="token number">16</span> <span class="token punctuation">,</span>      X <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #range <span class="token punctuation">(</span> minUInt16       <span class="token operator">&lt;=</span> X &lt;  pow16           <span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #rangeUInt    <span class="token punctuation">(</span>  <span class="token number">48</span> <span class="token punctuation">,</span>      X <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #range <span class="token punctuation">(</span> minUInt48       <span class="token operator">&lt;=</span> X &lt;  pow48           <span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #rangeUInt    <span class="token punctuation">(</span>  <span class="token number">96</span> <span class="token punctuation">,</span>      X <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #range <span class="token punctuation">(</span> minUInt96       <span class="token operator">&lt;=</span> X &lt;  pow96           <span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #rangeUInt    <span class="token punctuation">(</span> <span class="token number">128</span> <span class="token punctuation">,</span>      X <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #range <span class="token punctuation">(</span> minUInt128      <span class="token operator">&lt;=</span> X &lt;  pow128          <span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #rangeUInt    <span class="token punctuation">(</span> <span class="token number">160</span> <span class="token punctuation">,</span>      X <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #range <span class="token punctuation">(</span> minUInt160      <span class="token operator">&lt;=</span> X &lt;  pow160          <span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #rangeUInt    <span class="token punctuation">(</span> <span class="token number">168</span> <span class="token punctuation">,</span>      X <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #range <span class="token punctuation">(</span> minUInt168      <span class="token operator">&lt;=</span> X &lt;  pow168          <span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #rangeUInt    <span class="token punctuation">(</span> <span class="token number">208</span> <span class="token punctuation">,</span>      X <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #range <span class="token punctuation">(</span> minUInt208      <span class="token operator">&lt;=</span> X &lt;  pow208          <span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #rangeUInt    <span class="token punctuation">(</span> <span class="token number">224</span> <span class="token punctuation">,</span>      X <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #range <span class="token punctuation">(</span> minUInt224      <span class="token operator">&lt;=</span> X &lt;  pow224          <span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #rangeUInt    <span class="token punctuation">(</span> <span class="token number">256</span> <span class="token punctuation">,</span>      X <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #range <span class="token punctuation">(</span> minUInt256      <span class="token operator">&lt;=</span> X &lt;  pow256          <span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #rangeSFixed  <span class="token punctuation">(</span> <span class="token number">128</span> <span class="token punctuation">,</span> <span class="token number">10</span> <span class="token punctuation">,</span> X <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #range <span class="token punctuation">(</span> minSFixed128x10 <span class="token operator">&lt;=</span> X <span class="token operator">&lt;=</span> maxSFixed128x10 <span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #rangeUFixed  <span class="token punctuation">(</span> <span class="token number">128</span> <span class="token punctuation">,</span> <span class="token number">10</span> <span class="token punctuation">,</span> X <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #range <span class="token punctuation">(</span> minUFixed128x10 <span class="token operator">&lt;=</span> X <span class="token operator">&lt;=</span> maxUFixed128x10 <span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #rangeAddress <span class="token punctuation">(</span>            X <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #range <span class="token punctuation">(</span> minUInt160      <span class="token operator">&lt;=</span> X &lt;  pow160          <span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #rangeBytes   <span class="token punctuation">(</span>   N <span class="token punctuation">,</span>      X <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #range <span class="token punctuation">(</span> <span class="token number">0</span>               <span class="token operator">&lt;=</span> X &lt;  <span class="token number">1</span> &lt;&lt;Byte N      <span class="token punctuation">)</span>

    <span class="token keyword">syntax</span> <span class="token keyword">Bool</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;#range&quot;</span> <span class="token string">&quot;(&quot;</span> <span class="token keyword">Int</span> <span class="token string">&quot;&lt;&quot;</span>  <span class="token keyword">Int</span> <span class="token string">&quot;&lt;&quot;</span>  <span class="token keyword">Int</span> <span class="token string">&quot;)&quot;</span> <span class="token punctuation">[</span><span class="token class-name">macro</span><span class="token punctuation">]</span>
                  <span class="token operator">|</span> <span class="token string">&quot;#range&quot;</span> <span class="token string">&quot;(&quot;</span> <span class="token keyword">Int</span> <span class="token string">&quot;&lt;&quot;</span>  <span class="token keyword">Int</span> <span class="token string">&quot;&lt;=&quot;</span> <span class="token keyword">Int</span> <span class="token string">&quot;)&quot;</span> <span class="token punctuation">[</span><span class="token class-name">macro</span><span class="token punctuation">]</span>
                  <span class="token operator">|</span> <span class="token string">&quot;#range&quot;</span> <span class="token string">&quot;(&quot;</span> <span class="token keyword">Int</span> <span class="token string">&quot;&lt;=&quot;</span> <span class="token keyword">Int</span> <span class="token string">&quot;&lt;&quot;</span>  <span class="token keyword">Int</span> <span class="token string">&quot;)&quot;</span> <span class="token punctuation">[</span><span class="token class-name">macro</span><span class="token punctuation">]</span>
                  <span class="token operator">|</span> <span class="token string">&quot;#range&quot;</span> <span class="token string">&quot;(&quot;</span> <span class="token keyword">Int</span> <span class="token string">&quot;&lt;=&quot;</span> <span class="token keyword">Int</span> <span class="token string">&quot;&lt;=&quot;</span> <span class="token keyword">Int</span> <span class="token string">&quot;)&quot;</span> <span class="token punctuation">[</span><span class="token class-name">macro</span><span class="token punctuation">]</span>
 <span class="token comment">// --------------------------------------------------------------</span>
    <span class="token keyword">rule</span> #range <span class="token punctuation">(</span> LB &lt;  X &lt;  UB <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> LB  &lt;<span class="token keyword">Int</span> X andBool X  &lt;<span class="token keyword">Int</span> UB
    <span class="token keyword">rule</span> #range <span class="token punctuation">(</span> LB &lt;  X <span class="token operator">&lt;=</span> UB <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> LB  &lt;<span class="token keyword">Int</span> X andBool X <span class="token operator">&lt;=</span><span class="token keyword">Int</span> UB
    <span class="token keyword">rule</span> #range <span class="token punctuation">(</span> LB <span class="token operator">&lt;=</span> X &lt;  UB <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> LB <span class="token operator">&lt;=</span><span class="token keyword">Int</span> X andBool X  &lt;<span class="token keyword">Int</span> UB
    <span class="token keyword">rule</span> #range <span class="token punctuation">(</span> LB <span class="token operator">&lt;=</span> X <span class="token operator">&lt;=</span> UB <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> LB <span class="token operator">&lt;=</span><span class="token keyword">Int</span> X andBool X <span class="token operator">&lt;=</span><span class="token keyword">Int</span> UB
</code></pre>
<ul>
<li><code>chop</code> interprets an integer modulo <code>2^256</code>.</li>
</ul>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> <span class="token keyword">Int</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> chop <span class="token punctuation">(</span> <span class="token keyword">Int</span> <span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> functional<span class="token punctuation">,</span> smtlib<span class="token punctuation">(</span>chop<span class="token punctuation">)</span><span class="token punctuation">]</span>
 <span class="token comment">// ----------------------------------------------------------------</span>
    <span class="token keyword">rule</span> chop <span class="token punctuation">(</span> I<span class="token punctuation">:</span><span class="token keyword">Int</span> <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> I modInt pow256 <span class="token punctuation">[</span>concrete<span class="token punctuation">,</span> smt<span class="token operator">-</span>lemma<span class="token punctuation">]</span>
</code></pre>
<h3 id="boolean-conversions">Boolean Conversions</h3>
<p>Primitives provide the basic conversion from K&apos;s sorts <code>Int</code> and <code>Bool</code> to EVM&apos;s words.</p>
<ul>
<li><code>bool2Word</code> interprets a <code>Bool</code> as a <code>Int</code>.</li>
<li><code>word2Bool</code> interprets a <code>Int</code> as a <code>Bool</code>.</li>
</ul>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> <span class="token keyword">Int</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> bool2Word <span class="token punctuation">(</span> <span class="token keyword">Bool</span> <span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> functional<span class="token punctuation">,</span> smtlib<span class="token punctuation">(</span>bool2Word<span class="token punctuation">)</span><span class="token punctuation">]</span>
 <span class="token comment">// ---------------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> bool2Word<span class="token punctuation">(</span> B<span class="token punctuation">:</span><span class="token keyword">Bool</span> <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token number">1</span> <span class="token keyword">requires</span> B
    <span class="token keyword">rule</span> bool2Word<span class="token punctuation">(</span> B<span class="token punctuation">:</span><span class="token keyword">Bool</span> <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token number">0</span> <span class="token keyword">requires</span> notBool B

    <span class="token keyword">syntax</span> <span class="token keyword">Bool</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> word2Bool <span class="token punctuation">(</span> <span class="token keyword">Int</span> <span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> functional<span class="token punctuation">]</span>
 <span class="token comment">// --------------------------------------------------------</span>
    <span class="token keyword">rule</span> word2Bool<span class="token punctuation">(</span> W <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token boolean">false</span> <span class="token keyword">requires</span> W  <span class="token operator">==</span><span class="token keyword">Int</span> <span class="token number">0</span>
    <span class="token keyword">rule</span> word2Bool<span class="token punctuation">(</span> W <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token boolean">true</span>  <span class="token keyword">requires</span> W <span class="token operator">=</span><span class="token operator">/</span><span class="token operator">=</span><span class="token keyword">Int</span> <span class="token number">0</span>
</code></pre>
<ul>
<li><code>sgn</code> gives the twos-complement interperetation of the sign of a word.</li>
<li><code>abs</code> gives the twos-complement interperetation of the magnitude of a word.</li>
</ul>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> <span class="token keyword">Int</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> sgn <span class="token punctuation">(</span> <span class="token keyword">Int</span> <span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> functional<span class="token punctuation">]</span>
                 <span class="token operator">|</span> abs <span class="token punctuation">(</span> <span class="token keyword">Int</span> <span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> functional<span class="token punctuation">]</span>
 <span class="token comment">// -------------------------------------------------</span>
    <span class="token keyword">rule</span> sgn<span class="token punctuation">(</span>I<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token keyword">requires</span> pow255 <span class="token operator">&lt;=</span><span class="token keyword">Int</span> I andBool I &lt;<span class="token keyword">Int</span> pow256
    <span class="token keyword">rule</span> sgn<span class="token punctuation">(</span>I<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>  <span class="token number">1</span> <span class="token keyword">requires</span> <span class="token number">0</span> <span class="token operator">&lt;=</span><span class="token keyword">Int</span> I andBool I &lt;<span class="token keyword">Int</span> pow255
    <span class="token keyword">rule</span> sgn<span class="token punctuation">(</span>I<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>  <span class="token number">0</span> <span class="token keyword">requires</span> I &lt;<span class="token keyword">Int</span> <span class="token number">0</span> orBool pow256 <span class="token operator">&lt;=</span><span class="token keyword">Int</span> I

    <span class="token keyword">rule</span> abs<span class="token punctuation">(</span>I<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token number">0</span> <span class="token operator">-</span>Word I <span class="token keyword">requires</span> sgn<span class="token punctuation">(</span>I<span class="token punctuation">)</span> <span class="token operator">==</span><span class="token keyword">Int</span> <span class="token operator">-</span><span class="token number">1</span>
    <span class="token keyword">rule</span> abs<span class="token punctuation">(</span>I<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> I         <span class="token keyword">requires</span> sgn<span class="token punctuation">(</span>I<span class="token punctuation">)</span> <span class="token operator">==</span><span class="token keyword">Int</span>  <span class="token number">1</span>
    <span class="token keyword">rule</span> abs<span class="token punctuation">(</span>I<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token number">0</span>         <span class="token keyword">requires</span> sgn<span class="token punctuation">(</span>I<span class="token punctuation">)</span> <span class="token operator">==</span><span class="token keyword">Int</span>  <span class="token number">0</span>
</code></pre>
<h2 id="word-operations">Word Operations</h2>
<h3 id="low-level">Low-Level</h3>
<ul>
<li><code>up/Int</code> performs integer division but rounds up instead of down.</li>
</ul>
<p>NOTE: Here, we choose to add <code>I2 -Int 1</code> to the numerator beforing doing the division to mimic the C++ implementation.
You could alternatively calculate <code>I1 modInt I2</code>, then add one to the normal integer division afterward depending on the result.</p>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> <span class="token keyword">Int</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token keyword">Int</span> <span class="token string">&quot;up/Int&quot;</span> <span class="token keyword">Int</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> functional<span class="token punctuation">,</span> smtlib<span class="token punctuation">(</span>upDivInt<span class="token punctuation">)</span><span class="token punctuation">]</span>
 <span class="token comment">// ------------------------------------------------------------------------</span>
    <span class="token keyword">rule</span>              _I1 up<span class="token operator">/</span><span class="token keyword">Int</span> <span class="token number">0</span>  <span class="token operator">=&gt;</span> <span class="token number">0</span>
    <span class="token keyword">rule</span>              _I1 up<span class="token operator">/</span><span class="token keyword">Int</span> I2 <span class="token operator">=&gt;</span> <span class="token number">0</span>                             <span class="token keyword">requires</span> I2 &lt;<span class="token keyword">Int</span> <span class="token number">0</span>
    <span class="token keyword">rule</span>               I1 up<span class="token operator">/</span><span class="token keyword">Int</span> <span class="token number">1</span>  <span class="token operator">=&gt;</span> I1
    <span class="token keyword">rule</span> <span class="token punctuation">[</span>upDivInt<span class="token punctuation">]</span> <span class="token punctuation">:</span>  I1 up<span class="token operator">/</span><span class="token keyword">Int</span> I2 <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>I1 <span class="token operator">+</span><span class="token keyword">Int</span> <span class="token punctuation">(</span>I2 <span class="token operator">-</span><span class="token keyword">Int</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span><span class="token keyword">Int</span> I2 <span class="token keyword">requires</span> I2 &gt;<span class="token keyword">Int</span> <span class="token number">1</span>
</code></pre>
<ul>
<li><code>log256Int</code> returns the log base 256 (floored) of an integer.</li>
</ul>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> <span class="token keyword">Int</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> log256Int <span class="token punctuation">(</span> <span class="token keyword">Int</span> <span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
 <span class="token comment">// -------------------------------------------</span>
    <span class="token keyword">rule</span> log256Int<span class="token punctuation">(</span>N<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> log2Int<span class="token punctuation">(</span>N<span class="token punctuation">)</span> <span class="token operator">/</span><span class="token keyword">Int</span> <span class="token number">8</span>
</code></pre>
<p>The corresponding <code>&lt;op&gt;Word</code> operations automatically perform the correct modulus for EVM words.
Warning: operands are assumed to be within the range of a 256 bit EVM word. Unbound integers may not return the correct result.</p>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> <span class="token keyword">Int</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token keyword">Int</span> <span class="token string">&quot;+Word&quot;</span> <span class="token keyword">Int</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> functional<span class="token punctuation">]</span>
                 <span class="token operator">|</span> <span class="token keyword">Int</span> <span class="token string">&quot;*Word&quot;</span> <span class="token keyword">Int</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> functional<span class="token punctuation">]</span>
                 <span class="token operator">|</span> <span class="token keyword">Int</span> <span class="token string">&quot;-Word&quot;</span> <span class="token keyword">Int</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> functional<span class="token punctuation">]</span>
                 <span class="token operator">|</span> <span class="token keyword">Int</span> <span class="token string">&quot;/Word&quot;</span> <span class="token keyword">Int</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> functional<span class="token punctuation">]</span>
                 <span class="token operator">|</span> <span class="token keyword">Int</span> <span class="token string">&quot;%Word&quot;</span> <span class="token keyword">Int</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> functional<span class="token punctuation">]</span>
 <span class="token comment">// -----------------------------------------------------</span>
    <span class="token keyword">rule</span> W0 <span class="token operator">+</span>Word W1 <span class="token operator">=&gt;</span> chop<span class="token punctuation">(</span> W0 <span class="token operator">+</span><span class="token keyword">Int</span> W1 <span class="token punctuation">)</span>
    <span class="token keyword">rule</span> W0 <span class="token operator">-</span>Word W1 <span class="token operator">=&gt;</span> chop<span class="token punctuation">(</span> W0 <span class="token operator">-</span><span class="token keyword">Int</span> W1 <span class="token punctuation">)</span>
    <span class="token keyword">rule</span> W0 <span class="token operator">*</span>Word W1 <span class="token operator">=&gt;</span> chop<span class="token punctuation">(</span> W0 <span class="token operator">*</span><span class="token keyword">Int</span> W1 <span class="token punctuation">)</span>
    <span class="token keyword">rule</span>  _ <span class="token operator">/</span>Word W1 <span class="token operator">=&gt;</span> <span class="token number">0</span>            <span class="token keyword">requires</span> W1  <span class="token operator">==</span><span class="token keyword">Int</span> <span class="token number">0</span>
    <span class="token keyword">rule</span> W0 <span class="token operator">/</span>Word W1 <span class="token operator">=&gt;</span> W0 <span class="token operator">/</span><span class="token keyword">Int</span> W1   <span class="token keyword">requires</span> W1 <span class="token operator">=</span><span class="token operator">/</span><span class="token operator">=</span><span class="token keyword">Int</span> <span class="token number">0</span>
    <span class="token keyword">rule</span>  _ <span class="token operator">%</span>Word W1 <span class="token operator">=&gt;</span> <span class="token number">0</span>            <span class="token keyword">requires</span> W1  <span class="token operator">==</span><span class="token keyword">Int</span> <span class="token number">0</span>
    <span class="token keyword">rule</span> W0 <span class="token operator">%</span>Word W1 <span class="token operator">=&gt;</span> W0 modInt W1 <span class="token keyword">requires</span> W1 <span class="token operator">=</span><span class="token operator">/</span><span class="token operator">=</span><span class="token keyword">Int</span> <span class="token number">0</span>
</code></pre>
<p>Care is needed for <code>^Word</code> to avoid big exponentiation.
The helper <code>powmod</code> is a totalization of the operator <code>_^%Int__</code> (which comes with K).
<code>_^%Int__</code> is not defined when the modulus (third argument) is zero, but <code>powmod</code> is.</p>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> <span class="token keyword">Int</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token keyword">Int</span> <span class="token string">&quot;^Word&quot;</span> <span class="token keyword">Int</span>       <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
    <span class="token keyword">syntax</span> <span class="token keyword">Int</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> powmod<span class="token punctuation">(</span><span class="token keyword">Int</span><span class="token punctuation">,</span> <span class="token keyword">Int</span><span class="token punctuation">,</span> <span class="token keyword">Int</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> functional<span class="token punctuation">]</span>
 <span class="token comment">// -----------------------------------------------------------</span>
    <span class="token keyword">rule</span> W0 <span class="token operator">^</span>Word W1 <span class="token operator">=&gt;</span> powmod<span class="token punctuation">(</span>W0<span class="token punctuation">,</span> W1<span class="token punctuation">,</span> pow256<span class="token punctuation">)</span>

    <span class="token keyword">rule</span> <span class="token punctuation">[</span>powmod<span class="token punctuation">.</span>nonzero<span class="token punctuation">]</span><span class="token punctuation">:</span> powmod<span class="token punctuation">(</span>W0<span class="token punctuation">,</span> W1<span class="token punctuation">,</span> W2<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> W0 <span class="token operator">^</span><span class="token operator">%</span><span class="token keyword">Int</span> W1 W2  <span class="token keyword">requires</span> W2 <span class="token operator">=</span><span class="token operator">/</span><span class="token operator">=</span><span class="token keyword">Int</span> <span class="token number">0</span>
    <span class="token keyword">rule</span> <span class="token punctuation">[</span>powmod<span class="token punctuation">.</span>zero<span class="token punctuation">]</span><span class="token punctuation">:</span>    powmod<span class="token punctuation">(</span> _<span class="token punctuation">,</span>  _<span class="token punctuation">,</span> W2<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token number">0</span>               <span class="token keyword">requires</span> W2  <span class="token operator">==</span><span class="token keyword">Int</span> <span class="token number">0</span>
</code></pre>
<p><code>/sWord</code> and <code>%sWord</code> give the signed interperetations of <code>/Word</code> and <code>%Word</code>.</p>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> <span class="token keyword">Int</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token keyword">Int</span> <span class="token string">&quot;/sWord&quot;</span> <span class="token keyword">Int</span> <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
                 <span class="token operator">|</span> <span class="token keyword">Int</span> <span class="token string">&quot;%sWord&quot;</span> <span class="token keyword">Int</span> <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
 <span class="token comment">// ------------------------------------------</span>
    <span class="token keyword">rule</span> <span class="token punctuation">[</span>divSWord<span class="token punctuation">.</span>same<span class="token punctuation">]</span><span class="token punctuation">:</span> W0 <span class="token operator">/</span>sWord W1 <span class="token operator">=&gt;</span>          abs<span class="token punctuation">(</span>W0<span class="token punctuation">)</span> <span class="token operator">/</span>Word abs<span class="token punctuation">(</span>W1<span class="token punctuation">)</span>  <span class="token keyword">requires</span> sgn<span class="token punctuation">(</span>W0<span class="token punctuation">)</span> <span class="token operator">*</span><span class="token keyword">Int</span> sgn<span class="token punctuation">(</span>W1<span class="token punctuation">)</span> <span class="token operator">==</span><span class="token keyword">Int</span>  <span class="token number">1</span>
    <span class="token keyword">rule</span> <span class="token punctuation">[</span>divSWord<span class="token punctuation">.</span>diff<span class="token punctuation">]</span><span class="token punctuation">:</span> W0 <span class="token operator">/</span>sWord W1 <span class="token operator">=&gt;</span> <span class="token number">0</span> <span class="token operator">-</span>Word <span class="token punctuation">(</span>abs<span class="token punctuation">(</span>W0<span class="token punctuation">)</span> <span class="token operator">/</span>Word abs<span class="token punctuation">(</span>W1<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">requires</span> sgn<span class="token punctuation">(</span>W0<span class="token punctuation">)</span> <span class="token operator">*</span><span class="token keyword">Int</span> sgn<span class="token punctuation">(</span>W1<span class="token punctuation">)</span> <span class="token operator">==</span><span class="token keyword">Int</span> <span class="token operator">-</span><span class="token number">1</span>
    <span class="token keyword">rule</span> <span class="token punctuation">[</span>modSWord<span class="token punctuation">.</span>pos<span class="token punctuation">]</span><span class="token punctuation">:</span>  W0 <span class="token operator">%</span>sWord W1 <span class="token operator">=&gt;</span>          abs<span class="token punctuation">(</span>W0<span class="token punctuation">)</span> <span class="token operator">%</span>Word abs<span class="token punctuation">(</span>W1<span class="token punctuation">)</span>  <span class="token keyword">requires</span> sgn<span class="token punctuation">(</span>W0<span class="token punctuation">)</span> <span class="token operator">==</span><span class="token keyword">Int</span>  <span class="token number">1</span>
    <span class="token keyword">rule</span> <span class="token punctuation">[</span>modSWord<span class="token punctuation">.</span>neg<span class="token punctuation">]</span><span class="token punctuation">:</span>  W0 <span class="token operator">%</span>sWord W1 <span class="token operator">=&gt;</span> <span class="token number">0</span> <span class="token operator">-</span>Word <span class="token punctuation">(</span>abs<span class="token punctuation">(</span>W0<span class="token punctuation">)</span> <span class="token operator">%</span>Word abs<span class="token punctuation">(</span>W1<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">requires</span> sgn<span class="token punctuation">(</span>W0<span class="token punctuation">)</span> <span class="token operator">==</span><span class="token keyword">Int</span> <span class="token operator">-</span><span class="token number">1</span>
</code></pre>
<h3 id="word-comparison">Word Comparison</h3>
<p>The <code>&lt;op&gt;Word</code> comparisons similarly lift K operators to EVM ones:</p>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> <span class="token keyword">Int</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token keyword">Int</span> <span class="token string">&quot;&lt;Word&quot;</span>  <span class="token keyword">Int</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> functional<span class="token punctuation">]</span>
                 <span class="token operator">|</span> <span class="token keyword">Int</span> <span class="token string">&quot;&gt;Word&quot;</span>  <span class="token keyword">Int</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> functional<span class="token punctuation">]</span>
                 <span class="token operator">|</span> <span class="token keyword">Int</span> <span class="token string">&quot;&lt;=Word&quot;</span> <span class="token keyword">Int</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> functional<span class="token punctuation">]</span>
                 <span class="token operator">|</span> <span class="token keyword">Int</span> <span class="token string">&quot;&gt;=Word&quot;</span> <span class="token keyword">Int</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> functional<span class="token punctuation">]</span>
                 <span class="token operator">|</span> <span class="token keyword">Int</span> <span class="token string">&quot;==Word&quot;</span> <span class="token keyword">Int</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> functional<span class="token punctuation">]</span>
 <span class="token comment">// ------------------------------------------------------</span>
    <span class="token keyword">rule</span> W0 &lt;Word  W1 <span class="token operator">=&gt;</span> bool2Word<span class="token punctuation">(</span>W0 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Int</span>  <span class="token attr-name">W1)</span>
    <span class="token attr-name">rule</span> <span class="token attr-name">W0</span> <span class="token punctuation">&gt;</span></span>Word  W1 <span class="token operator">=&gt;</span> bool2Word<span class="token punctuation">(</span>W0 &gt;<span class="token keyword">Int</span>  W1<span class="token punctuation">)</span>
    <span class="token keyword">rule</span> W0 <span class="token operator">&lt;=</span>Word W1 <span class="token operator">=&gt;</span> bool2Word<span class="token punctuation">(</span>W0 <span class="token operator">&lt;=</span><span class="token keyword">Int</span> W1<span class="token punctuation">)</span>
    <span class="token keyword">rule</span> W0 <span class="token operator">&gt;=</span>Word W1 <span class="token operator">=&gt;</span> bool2Word<span class="token punctuation">(</span>W0 <span class="token operator">&gt;=</span><span class="token keyword">Int</span> W1<span class="token punctuation">)</span>
    <span class="token keyword">rule</span> W0 <span class="token operator">==</span>Word W1 <span class="token operator">=&gt;</span> bool2Word<span class="token punctuation">(</span>W0 <span class="token operator">==</span><span class="token keyword">Int</span> W1<span class="token punctuation">)</span>
</code></pre>
<ul>
<li><code>s&lt;Word</code> implements a less-than for <code>Word</code> (with signed interperetation).</li>
</ul>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> <span class="token keyword">Int</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token keyword">Int</span> <span class="token string">&quot;s&lt;Word&quot;</span> <span class="token keyword">Int</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> functional<span class="token punctuation">]</span>
 <span class="token comment">// ------------------------------------------------------</span>
    <span class="token keyword">rule</span> <span class="token punctuation">[</span>s&lt;Word<span class="token punctuation">.</span>pp<span class="token punctuation">]</span><span class="token punctuation">:</span> W0 s&lt;Word W1 <span class="token operator">=&gt;</span> W0 &lt;Word W1           <span class="token keyword">requires</span> sgn<span class="token punctuation">(</span>W0<span class="token punctuation">)</span> <span class="token operator">==</span>K <span class="token number">1</span>  andBool sgn<span class="token punctuation">(</span>W1<span class="token punctuation">)</span> <span class="token operator">==</span>K <span class="token number">1</span>
    <span class="token keyword">rule</span> <span class="token punctuation">[</span>s&lt;Word<span class="token punctuation">.</span>pn<span class="token punctuation">]</span><span class="token punctuation">:</span> W0 s&lt;Word W1 <span class="token operator">=&gt;</span> bool2Word<span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>      <span class="token keyword">requires</span> sgn<span class="token punctuation">(</span>W0<span class="token punctuation">)</span> <span class="token operator">==</span>K <span class="token number">1</span>  andBool sgn<span class="token punctuation">(</span>W1<span class="token punctuation">)</span> <span class="token operator">==</span>K <span class="token operator">-</span><span class="token number">1</span>
    <span class="token keyword">rule</span> <span class="token punctuation">[</span>s&lt;Word<span class="token punctuation">.</span>np<span class="token punctuation">]</span><span class="token punctuation">:</span> W0 s&lt;Word W1 <span class="token operator">=&gt;</span> bool2Word<span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>       <span class="token keyword">requires</span> sgn<span class="token punctuation">(</span>W0<span class="token punctuation">)</span> <span class="token operator">==</span>K <span class="token operator">-</span><span class="token number">1</span> andBool sgn<span class="token punctuation">(</span>W1<span class="token punctuation">)</span> <span class="token operator">==</span>K <span class="token number">1</span>
    <span class="token keyword">rule</span> <span class="token punctuation">[</span>s&lt;Word<span class="token punctuation">.</span>nn<span class="token punctuation">]</span><span class="token punctuation">:</span> W0 s&lt;Word W1 <span class="token operator">=&gt;</span> abs<span class="token punctuation">(</span>W1<span class="token punctuation">)</span> &lt;Word abs<span class="token punctuation">(</span>W0<span class="token punctuation">)</span> <span class="token keyword">requires</span> sgn<span class="token punctuation">(</span>W0<span class="token punctuation">)</span> <span class="token operator">==</span>K <span class="token operator">-</span><span class="token number">1</span> andBool sgn<span class="token punctuation">(</span>W1<span class="token punctuation">)</span> <span class="token operator">==</span>K <span class="token operator">-</span><span class="token number">1</span>
</code></pre>
<h3 id="bitwise-operators">Bitwise Operators</h3>
<p>Bitwise logical operators are lifted from the integer versions.</p>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> <span class="token keyword">Int</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;~Word&quot;</span> <span class="token keyword">Int</span>       <span class="token punctuation">[</span>function<span class="token punctuation">,</span> functional<span class="token punctuation">]</span>
                 <span class="token operator">|</span> <span class="token keyword">Int</span> <span class="token string">&quot;|Word&quot;</span>   <span class="token keyword">Int</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> functional<span class="token punctuation">]</span>
                 <span class="token operator">|</span> <span class="token keyword">Int</span> <span class="token string">&quot;&amp;Word&quot;</span>   <span class="token keyword">Int</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> functional<span class="token punctuation">]</span>
                 <span class="token operator">|</span> <span class="token keyword">Int</span> <span class="token string">&quot;xorWord&quot;</span> <span class="token keyword">Int</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> functional<span class="token punctuation">]</span>
                 <span class="token operator">|</span> <span class="token keyword">Int</span> <span class="token string">&quot;&lt;&lt;Word&quot;</span>  <span class="token keyword">Int</span> <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
                 <span class="token operator">|</span> <span class="token keyword">Int</span> <span class="token string">&quot;&gt;&gt;Word&quot;</span>  <span class="token keyword">Int</span> <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
                 <span class="token operator">|</span> <span class="token keyword">Int</span> <span class="token string">&quot;&gt;&gt;sWord&quot;</span> <span class="token keyword">Int</span> <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
 <span class="token comment">// -------------------------------------------</span>
    <span class="token keyword">rule</span> <span class="token operator">~</span>Word W       <span class="token operator">=&gt;</span> W xorInt maxUInt256
    <span class="token keyword">rule</span> W0 <span class="token operator">|</span>Word   W1 <span class="token operator">=&gt;</span> W0 <span class="token operator">|</span><span class="token keyword">Int</span> W1
    <span class="token keyword">rule</span> W0 <span class="token operator">&amp;</span>Word   W1 <span class="token operator">=&gt;</span> W0 <span class="token operator">&amp;</span><span class="token keyword">Int</span> W1
    <span class="token keyword">rule</span> W0 xorWord W1 <span class="token operator">=&gt;</span> W0 xorInt W1
    <span class="token keyword">rule</span> W0 &lt;&lt;Word  W1 <span class="token operator">=&gt;</span> chop<span class="token punctuation">(</span> W0 &lt;&lt;<span class="token keyword">Int</span> W1 <span class="token punctuation">)</span> <span class="token keyword">requires</span> W1 &lt;<span class="token keyword">Int</span> <span class="token number">256</span>
    <span class="token keyword">rule</span>  _ &lt;&lt;Word  W1 <span class="token operator">=&gt;</span> <span class="token number">0</span> <span class="token keyword">requires</span> W1 <span class="token operator">&gt;=</span><span class="token keyword">Int</span> <span class="token number">256</span>
    <span class="token keyword">rule</span> W0 &gt;&gt;Word  W1 <span class="token operator">=&gt;</span> W0 &gt;&gt;<span class="token keyword">Int</span> W1
    <span class="token keyword">rule</span> W0 &gt;&gt;sWord W1 <span class="token operator">=&gt;</span> chop<span class="token punctuation">(</span> <span class="token punctuation">(</span>abs<span class="token punctuation">(</span>W0<span class="token punctuation">)</span> <span class="token operator">*</span><span class="token keyword">Int</span> sgn<span class="token punctuation">(</span>W0<span class="token punctuation">)</span><span class="token punctuation">)</span> &gt;&gt;<span class="token keyword">Int</span> W1 <span class="token punctuation">)</span>
</code></pre>
<ul>
<li><code>bit</code> gets bit <code>N</code> (0 being MSB).</li>
<li><code>byte</code> gets byte <code>N</code> (0 being the MSB).</li>
</ul>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> <span class="token keyword">Int</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> bit  <span class="token punctuation">(</span> <span class="token keyword">Int</span> <span class="token punctuation">,</span> <span class="token keyword">Int</span> <span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
                 <span class="token operator">|</span> byte <span class="token punctuation">(</span> <span class="token keyword">Int</span> <span class="token punctuation">,</span> <span class="token keyword">Int</span> <span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
 <span class="token comment">// --------------------------------------------</span>
    <span class="token keyword">rule</span> bit <span class="token punctuation">(</span>N<span class="token punctuation">,</span> _<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token number">0</span> <span class="token keyword">requires</span> notBool <span class="token punctuation">(</span>N <span class="token operator">&gt;=</span><span class="token keyword">Int</span> <span class="token number">0</span> andBool N &lt;<span class="token keyword">Int</span> <span class="token number">256</span><span class="token punctuation">)</span>
    <span class="token keyword">rule</span> byte<span class="token punctuation">(</span>N<span class="token punctuation">,</span> _<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token number">0</span> <span class="token keyword">requires</span> notBool <span class="token punctuation">(</span>N <span class="token operator">&gt;=</span><span class="token keyword">Int</span> <span class="token number">0</span> andBool N &lt;<span class="token keyword">Int</span>  <span class="token number">32</span><span class="token punctuation">)</span>

    <span class="token keyword">rule</span> bit <span class="token punctuation">(</span>N<span class="token punctuation">,</span> W<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> bitRangeInt<span class="token punctuation">(</span>W <span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">255</span> <span class="token operator">-</span><span class="token keyword">Int</span> N<span class="token punctuation">)</span>        <span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">requires</span> N <span class="token operator">&gt;=</span><span class="token keyword">Int</span> <span class="token number">0</span> andBool N &lt;<span class="token keyword">Int</span> <span class="token number">256</span>
    <span class="token keyword">rule</span> byte<span class="token punctuation">(</span>N<span class="token punctuation">,</span> W<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> bitRangeInt<span class="token punctuation">(</span>W <span class="token punctuation">,</span> <span class="token punctuation">(</span> <span class="token number">31</span> <span class="token operator">-</span><span class="token keyword">Int</span> N<span class="token punctuation">)</span> <span class="token operator">*</span><span class="token keyword">Int</span> <span class="token number">8</span> <span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token keyword">requires</span> N <span class="token operator">&gt;=</span><span class="token keyword">Int</span> <span class="token number">0</span> andBool N &lt;<span class="token keyword">Int</span>  <span class="token number">32</span>
</code></pre>
<ul>
<li><code>#nBits</code> shifts in <code>N</code> ones from the right.</li>
<li><code>#nBytes</code> shifts in <code>N</code> bytes of ones from the right.</li>
<li><code>_&lt;&lt;Byte_</code> shifts an integer 8 bits to the left.</li>
<li><code>_&gt;&gt;Byte_</code> shifts an integer 8 bits to the right.</li>
</ul>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> <span class="token keyword">Int</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #nBits  <span class="token punctuation">(</span> <span class="token keyword">Int</span> <span class="token punctuation">)</span>  <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
                 <span class="token operator">|</span> #nBytes <span class="token punctuation">(</span> <span class="token keyword">Int</span> <span class="token punctuation">)</span>  <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
                 <span class="token operator">|</span> <span class="token keyword">Int</span> <span class="token string">&quot;&lt;&lt;Byte&quot;</span> <span class="token keyword">Int</span> <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
                 <span class="token operator">|</span> <span class="token keyword">Int</span> <span class="token string">&quot;&gt;&gt;Byte&quot;</span> <span class="token keyword">Int</span> <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
 <span class="token comment">// ------------------------------------------</span>
    <span class="token keyword">rule</span> #nBits<span class="token punctuation">(</span>N<span class="token punctuation">)</span>  <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token number">1</span> &lt;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Int</span> <span class="token attr-name">N)</span> <span class="token attr-name">-Int</span> <span class="token attr-name">1</span> <span class="token attr-name">requires</span> <span class="token attr-name">N</span> <span class="token punctuation">&gt;</span></span><span class="token operator">=</span><span class="token keyword">Int</span> <span class="token number">0</span>
    <span class="token keyword">rule</span> #nBytes<span class="token punctuation">(</span>N<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #nBits<span class="token punctuation">(</span>N <span class="token operator">*</span><span class="token keyword">Int</span> <span class="token number">8</span><span class="token punctuation">)</span>   <span class="token keyword">requires</span> N <span class="token operator">&gt;=</span><span class="token keyword">Int</span> <span class="token number">0</span>
    <span class="token keyword">rule</span> N &lt;&lt;Byte M <span class="token operator">=&gt;</span> N &lt;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Int</span> <span class="token attr-name">(8</span> <span class="token attr-name">*Int</span> <span class="token attr-name">M)</span>
    <span class="token attr-name">rule</span> <span class="token attr-name">N</span> <span class="token punctuation">&gt;</span></span>&gt;Byte M <span class="token operator">=&gt;</span> N &gt;&gt;<span class="token keyword">Int</span> <span class="token punctuation">(</span><span class="token number">8</span> <span class="token operator">*</span><span class="token keyword">Int</span> M<span class="token punctuation">)</span>
</code></pre>
<ul>
<li><code>signextend(N, W)</code> sign-extends from byte <code>N</code> of <code>W</code> (0 being MSB).</li>
</ul>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> <span class="token keyword">Int</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> signextend<span class="token punctuation">(</span> <span class="token keyword">Int</span> <span class="token punctuation">,</span> <span class="token keyword">Int</span> <span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> functional<span class="token punctuation">]</span>
 <span class="token comment">// -------------------------------------------------------------</span>
    <span class="token keyword">rule</span> <span class="token punctuation">[</span>signextend<span class="token punctuation">.</span>invalid<span class="token punctuation">]</span><span class="token punctuation">:</span>  signextend<span class="token punctuation">(</span>N<span class="token punctuation">,</span> W<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> W <span class="token keyword">requires</span> N <span class="token operator">&gt;=</span><span class="token keyword">Int</span> <span class="token number">32</span> orBool N &lt;<span class="token keyword">Int</span> <span class="token number">0</span>
    <span class="token keyword">rule</span> <span class="token punctuation">[</span>signextend<span class="token punctuation">.</span>negative<span class="token punctuation">]</span><span class="token punctuation">:</span> signextend<span class="token punctuation">(</span>N<span class="token punctuation">,</span> W<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> chop<span class="token punctuation">(</span> <span class="token punctuation">(</span>#nBytes<span class="token punctuation">(</span><span class="token number">31</span> <span class="token operator">-</span><span class="token keyword">Int</span> N<span class="token punctuation">)</span> &lt;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Byte</span> <span class="token attr-name">(N</span> <span class="token attr-name">+Int</span> <span class="token attr-name">1))</span> <span class="token attr-name">|Int</span> <span class="token attr-name">W</span> <span class="token attr-name">)</span> <span class="token attr-name">requires</span> <span class="token attr-name">N</span> <span class="token attr-name">&lt;Int</span> <span class="token attr-name">32</span> <span class="token attr-name">andBool</span> <span class="token attr-name">N</span> <span class="token punctuation">&gt;</span></span><span class="token operator">=</span><span class="token keyword">Int</span> <span class="token number">0</span> andBool         word2Bool<span class="token punctuation">(</span>bit<span class="token punctuation">(</span><span class="token number">256</span> <span class="token operator">-</span><span class="token keyword">Int</span> <span class="token punctuation">(</span><span class="token number">8</span> <span class="token operator">*</span><span class="token keyword">Int</span> <span class="token punctuation">(</span>N <span class="token operator">+</span><span class="token keyword">Int</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> W<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">rule</span> <span class="token punctuation">[</span>signextend<span class="token punctuation">.</span>positive<span class="token punctuation">]</span><span class="token punctuation">:</span> signextend<span class="token punctuation">(</span>N<span class="token punctuation">,</span> W<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> chop<span class="token punctuation">(</span> #nBytes<span class="token punctuation">(</span>N <span class="token operator">+</span><span class="token keyword">Int</span> <span class="token number">1</span><span class="token punctuation">)</span>                      <span class="token operator">&amp;</span><span class="token keyword">Int</span> W <span class="token punctuation">)</span> <span class="token keyword">requires</span> N <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Int</span> <span class="token attr-name">32</span> <span class="token attr-name">andBool</span> <span class="token attr-name">N</span> <span class="token punctuation">&gt;</span></span><span class="token operator">=</span><span class="token keyword">Int</span> <span class="token number">0</span> andBool notBool word2Bool<span class="token punctuation">(</span>bit<span class="token punctuation">(</span><span class="token number">256</span> <span class="token operator">-</span><span class="token keyword">Int</span> <span class="token punctuation">(</span><span class="token number">8</span> <span class="token operator">*</span><span class="token keyword">Int</span> <span class="token punctuation">(</span>N <span class="token operator">+</span><span class="token keyword">Int</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> W<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
<h2 id="a-wordstack-for-evm">A WordStack for EVM</h2>
<h3 id="as-a-cons-list">As a cons-list</h3>
<p>A cons-list is used for the EVM wordstack.</p>
<ul>
<li><code>.WordStack</code> serves as the empty worstack, and</li>
<li><code>_:_</code> serves as the &quot;cons&quot; operator.</li>
</ul>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> WordStack <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;.WordStack&quot;</span>      <span class="token punctuation">[</span>smtlib<span class="token punctuation">(</span>_dotWS<span class="token punctuation">)</span><span class="token punctuation">]</span>
                       <span class="token operator">|</span> <span class="token keyword">Int</span> <span class="token string">&quot;:&quot;</span> WordStack <span class="token punctuation">[</span><span class="token class-name">klabel</span><span class="token punctuation">(</span>_<span class="token punctuation">:</span>_WS<span class="token punctuation">)</span><span class="token punctuation">,</span> smtlib<span class="token punctuation">(</span>_WS_<span class="token punctuation">)</span><span class="token punctuation">]</span>
 <span class="token comment">// --------------------------------------------------------------------</span>
</code></pre>
<pre class="language-text"><code>    syntax Bytes ::= Int &quot;:&quot; Bytes [function]
 // -----------------------------------------
    rule I : BS =&gt; Int2Bytes(1, I, BE) ++ BS requires I &lt;Int 256
</code></pre>
<ul>
<li><code>#take(N , WS)</code> keeps the first <code>N</code> elements of a <code>WordStack</code> (passing with zeros as needed).</li>
<li><code>#drop(N , WS)</code> removes the first <code>N</code> elements of a <code>WordStack</code>.</li>
</ul>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> WordStack <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #take <span class="token punctuation">(</span> <span class="token keyword">Int</span> <span class="token punctuation">,</span> WordStack <span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token class-name">klabel</span><span class="token punctuation">(</span>takeWordStack<span class="token punctuation">)</span><span class="token punctuation">,</span> function<span class="token punctuation">,</span> functional<span class="token punctuation">]</span>
 <span class="token comment">// --------------------------------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> <span class="token punctuation">[</span>#take<span class="token punctuation">.</span>base<span class="token punctuation">]</span><span class="token punctuation">:</span>      #take<span class="token punctuation">(</span>N<span class="token punctuation">,</span> _WS<span class="token punctuation">)</span>                <span class="token operator">=&gt;</span> <span class="token punctuation">.</span>WordStack                      <span class="token keyword">requires</span> notBool N &gt;<span class="token keyword">Int</span> <span class="token number">0</span>
    <span class="token keyword">rule</span> <span class="token punctuation">[</span>#take<span class="token punctuation">.</span>zero<span class="token operator">-</span>pad<span class="token punctuation">]</span><span class="token punctuation">:</span>  #take<span class="token punctuation">(</span>N<span class="token punctuation">,</span> <span class="token punctuation">.</span>WordStack<span class="token punctuation">)</span>         <span class="token operator">=&gt;</span> <span class="token number">0</span> <span class="token punctuation">:</span> #take<span class="token punctuation">(</span>N <span class="token operator">-</span><span class="token keyword">Int</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">.</span>WordStack<span class="token punctuation">)</span> <span class="token keyword">requires</span> N &gt;<span class="token keyword">Int</span> <span class="token number">0</span>
    <span class="token keyword">rule</span> <span class="token punctuation">[</span>#take<span class="token punctuation">.</span>recursive<span class="token punctuation">]</span><span class="token punctuation">:</span> #take<span class="token punctuation">(</span>N<span class="token punctuation">,</span> <span class="token punctuation">(</span>W <span class="token punctuation">:</span> WS<span class="token punctuation">)</span><span class="token punctuation">:</span>WordStack<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> W <span class="token punctuation">:</span> #take<span class="token punctuation">(</span>N <span class="token operator">-</span><span class="token keyword">Int</span> <span class="token number">1</span><span class="token punctuation">,</span> WS<span class="token punctuation">)</span>         <span class="token keyword">requires</span> N &gt;<span class="token keyword">Int</span> <span class="token number">0</span>

    <span class="token keyword">syntax</span> WordStack <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #drop <span class="token punctuation">(</span> <span class="token keyword">Int</span> <span class="token punctuation">,</span> WordStack <span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token class-name">klabel</span><span class="token punctuation">(</span>dropWordStack<span class="token punctuation">)</span><span class="token punctuation">,</span> function<span class="token punctuation">,</span> functional<span class="token punctuation">]</span>
 <span class="token comment">// --------------------------------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> #drop<span class="token punctuation">(</span>N<span class="token punctuation">,</span> WS<span class="token punctuation">:</span>WordStack<span class="token punctuation">)</span>       <span class="token operator">=&gt;</span> WS                                  <span class="token keyword">requires</span> notBool N &gt;<span class="token keyword">Int</span> <span class="token number">0</span>
    <span class="token keyword">rule</span> #drop<span class="token punctuation">(</span>N<span class="token punctuation">,</span> <span class="token punctuation">.</span>WordStack<span class="token punctuation">)</span>         <span class="token operator">=&gt;</span> <span class="token punctuation">.</span>WordStack                          <span class="token keyword">requires</span>         N &gt;<span class="token keyword">Int</span> <span class="token number">0</span>
    <span class="token keyword">rule</span> #drop<span class="token punctuation">(</span>N<span class="token punctuation">,</span> <span class="token punctuation">(</span>W <span class="token punctuation">:</span> WS<span class="token punctuation">)</span><span class="token punctuation">:</span>WordStack<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #drop<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> #drop<span class="token punctuation">(</span>N <span class="token operator">-</span><span class="token keyword">Int</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>W <span class="token punctuation">:</span> WS<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">requires</span>         N &gt;<span class="token keyword">Int</span> <span class="token number">1</span>
    <span class="token keyword">rule</span> #drop<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>_ <span class="token punctuation">:</span> WS<span class="token punctuation">)</span><span class="token punctuation">:</span>WordStack<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> WS
</code></pre>
<pre class="language-text"><code>    syntax Bytes ::= #take ( Int , Bytes ) [klabel(takeBytes), function, functional]
 // --------------------------------------------------------------------------------
    rule #take(N, _BS:Bytes) =&gt; .Bytes                                      requires                                        notBool N &gt;Int 0
    rule #take(N,  BS:Bytes) =&gt; #padRightToWidth(N, .Bytes)                 requires notBool lengthBytes(BS) &gt;Int 0 andBool         N &gt;Int 0
    rule #take(N,  BS:Bytes) =&gt; BS ++ #take(N -Int lengthBytes(BS), .Bytes) requires         lengthBytes(BS) &gt;Int 0 andBool notBool N &gt;Int lengthBytes(BS)
    rule #take(N,  BS:Bytes) =&gt; BS [ 0 .. N ]                               requires         lengthBytes(BS) &gt;Int 0 andBool         N &gt;Int lengthBytes(BS)

    syntax Bytes ::= #drop ( Int , Bytes ) [klabel(dropBytes), function, functional]
 // --------------------------------------------------------------------------------
    rule #drop(N, BS:Bytes) =&gt; BS                                  requires                                        notBool N &gt;Int 0
    rule #drop(N, BS:Bytes) =&gt; .Bytes                              requires notBool lengthBytes(BS) &gt;Int 0 andBool         N &gt;Int 0
    rule #drop(N, BS:Bytes) =&gt; .Bytes                              requires         lengthBytes(BS) &gt;Int 0 andBool         N &gt;Int lengthBytes(BS)
    rule #drop(N, BS:Bytes) =&gt; substrBytes(BS, N, lengthBytes(BS)) requires         lengthBytes(BS) &gt;Int 0 andBool notBool N &gt;Int lengthBytes(BS)
</code></pre>
<h3 id="element-access">Element Access</h3>
<ul>
<li><code>WS [ N ]</code> accesses element <code>N</code> of <code>WS</code>.</li>
<li><code>WS [ N := W ]</code> sets element <code>N</code> of <code>WS</code> to <code>W</code> (padding with zeros as needed).</li>
</ul>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> <span class="token keyword">Int</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> WordStack <span class="token string">&quot;[&quot;</span> <span class="token keyword">Int</span> <span class="token string">&quot;]&quot;</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> functional<span class="token punctuation">]</span>
 <span class="token comment">// -----------------------------------------------------------</span>
    <span class="token keyword">rule</span> <span class="token punctuation">(</span>W <span class="token punctuation">:</span> _<span class="token punctuation">)</span><span class="token punctuation">:</span>WordStack <span class="token punctuation">[</span> N <span class="token punctuation">]</span> <span class="token operator">=&gt;</span> W                  <span class="token keyword">requires</span> N <span class="token operator">==</span><span class="token keyword">Int</span> <span class="token number">0</span>
    <span class="token keyword">rule</span> WS<span class="token punctuation">:</span>WordStack      <span class="token punctuation">[</span> N <span class="token punctuation">]</span> <span class="token operator">=&gt;</span> #drop<span class="token punctuation">(</span>N<span class="token punctuation">,</span> WS<span class="token punctuation">)</span> <span class="token punctuation">[</span> <span class="token number">0</span> <span class="token punctuation">]</span> <span class="token keyword">requires</span> N  &gt;<span class="token keyword">Int</span> <span class="token number">0</span>
    <span class="token keyword">rule</span>  _<span class="token punctuation">:</span>WordStack      <span class="token punctuation">[</span> N <span class="token punctuation">]</span> <span class="token operator">=&gt;</span> <span class="token number">0</span>                  <span class="token keyword">requires</span> N  &lt;<span class="token keyword">Int</span> <span class="token number">0</span>

    <span class="token keyword">syntax</span> WordStack <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> WordStack <span class="token string">&quot;[&quot;</span> <span class="token keyword">Int</span> <span class="token string">&quot;:=&quot;</span> <span class="token keyword">Int</span> <span class="token string">&quot;]&quot;</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> functional<span class="token punctuation">]</span>
 <span class="token comment">// --------------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> <span class="token punctuation">(</span>_W0 <span class="token punctuation">:</span> WS<span class="token punctuation">)</span><span class="token punctuation">:</span>WordStack <span class="token punctuation">[</span> N <span class="token punctuation">:</span><span class="token operator">=</span> W <span class="token punctuation">]</span> <span class="token operator">=&gt;</span> W  <span class="token punctuation">:</span> WS                     <span class="token keyword">requires</span> N <span class="token operator">==</span><span class="token keyword">Int</span> <span class="token number">0</span>
    <span class="token keyword">rule</span> <span class="token punctuation">(</span> W0 <span class="token punctuation">:</span> WS<span class="token punctuation">)</span><span class="token punctuation">:</span>WordStack <span class="token punctuation">[</span> N <span class="token punctuation">:</span><span class="token operator">=</span> W <span class="token punctuation">]</span> <span class="token operator">=&gt;</span> W0 <span class="token punctuation">:</span> <span class="token punctuation">(</span>WS <span class="token punctuation">[</span> N <span class="token operator">-</span><span class="token keyword">Int</span> <span class="token number">1</span> <span class="token punctuation">:</span><span class="token operator">=</span> W <span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">requires</span> N  &gt;<span class="token keyword">Int</span> <span class="token number">0</span>
    <span class="token keyword">rule</span>        WS <span class="token punctuation">:</span>WordStack <span class="token punctuation">[</span> N <span class="token punctuation">:</span><span class="token operator">=</span> _ <span class="token punctuation">]</span> <span class="token operator">=&gt;</span> WS                          <span class="token keyword">requires</span> N  &lt;<span class="token keyword">Int</span> <span class="token number">0</span>
    <span class="token keyword">rule</span> <span class="token punctuation">.</span>WordStack           <span class="token punctuation">[</span> N <span class="token punctuation">:</span><span class="token operator">=</span> W <span class="token punctuation">]</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token punctuation">:</span> <span class="token punctuation">.</span>WordStack<span class="token punctuation">)</span> <span class="token punctuation">[</span> N <span class="token punctuation">:</span><span class="token operator">=</span> W <span class="token punctuation">]</span>
</code></pre>
<ul>
<li><code>#sizeWordStack</code> calculates the size of a <code>WordStack</code>.</li>
<li><code>_in_</code> determines if a <code>Int</code> occurs in a <code>WordStack</code>.</li>
</ul>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> <span class="token keyword">Int</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #sizeWordStack <span class="token punctuation">(</span> WordStack <span class="token punctuation">)</span>       <span class="token punctuation">[</span>function<span class="token punctuation">,</span> functional<span class="token punctuation">,</span> smtlib<span class="token punctuation">(</span>sizeWordStack<span class="token punctuation">)</span><span class="token punctuation">]</span>
                 <span class="token operator">|</span> #sizeWordStack <span class="token punctuation">(</span> WordStack <span class="token punctuation">,</span> <span class="token keyword">Int</span> <span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> functional<span class="token punctuation">,</span> <span class="token class-name">klabel</span><span class="token punctuation">(</span>sizeWordStackAux<span class="token punctuation">)</span><span class="token punctuation">,</span> smtlib<span class="token punctuation">(</span>sizeWordStackAux<span class="token punctuation">)</span><span class="token punctuation">]</span>
 <span class="token comment">// ----------------------------------------------------------------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> #sizeWordStack <span class="token punctuation">(</span> WS <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #sizeWordStack<span class="token punctuation">(</span>WS<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #sizeWordStack <span class="token punctuation">(</span> <span class="token punctuation">.</span>WordStack<span class="token punctuation">,</span> SIZE <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> SIZE
    <span class="token keyword">rule</span> #sizeWordStack <span class="token punctuation">(</span> _ <span class="token punctuation">:</span> WS<span class="token punctuation">,</span> SIZE <span class="token punctuation">)</span>     <span class="token operator">=&gt;</span> #sizeWordStack<span class="token punctuation">(</span>WS<span class="token punctuation">,</span> SIZE <span class="token operator">+</span><span class="token keyword">Int</span> <span class="token number">1</span><span class="token punctuation">)</span>

    <span class="token keyword">syntax</span> <span class="token keyword">Bool</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token keyword">Int</span> <span class="token string">&quot;in&quot;</span> WordStack <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
 <span class="token comment">// ---------------------------------------------</span>
    <span class="token keyword">rule</span> _ in <span class="token punctuation">.</span>WordStack <span class="token operator">=&gt;</span> <span class="token boolean">false</span>
    <span class="token keyword">rule</span> W in <span class="token punctuation">(</span>W<span class="token string">&apos; : WS)  =&gt; (W ==K W&apos;</span><span class="token punctuation">)</span> orElseBool <span class="token punctuation">(</span>W in WS<span class="token punctuation">)</span>
</code></pre>
<ul>
<li><code>#replicateAux</code> pushes <code>N</code> copies of <code>A</code> onto a <code>WordStack</code>.</li>
<li><code>#replicate</code> is a <code>WordStack</code> of length <code>N</code> with <code>A</code> the value of every element.</li>
</ul>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> WordStack <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #replicate    <span class="token punctuation">(</span> <span class="token keyword">Int</span><span class="token punctuation">,</span> <span class="token keyword">Int</span> <span class="token punctuation">)</span>            <span class="token punctuation">[</span>function<span class="token punctuation">,</span> functional<span class="token punctuation">]</span>
                       <span class="token operator">|</span> #replicateAux <span class="token punctuation">(</span> <span class="token keyword">Int</span><span class="token punctuation">,</span> <span class="token keyword">Int</span><span class="token punctuation">,</span> WordStack <span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> functional<span class="token punctuation">]</span>
 <span class="token comment">// ---------------------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> #replicate   <span class="token punctuation">(</span> N<span class="token punctuation">,</span>  A <span class="token punctuation">)</span>     <span class="token operator">=&gt;</span> #replicateAux<span class="token punctuation">(</span>N<span class="token punctuation">,</span> A<span class="token punctuation">,</span> <span class="token punctuation">.</span>WordStack<span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #replicateAux<span class="token punctuation">(</span> N<span class="token punctuation">,</span>  A<span class="token punctuation">,</span> WS <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #replicateAux<span class="token punctuation">(</span>N <span class="token operator">-</span><span class="token keyword">Int</span> <span class="token number">1</span><span class="token punctuation">,</span> A<span class="token punctuation">,</span> A <span class="token punctuation">:</span> WS<span class="token punctuation">)</span> <span class="token keyword">requires</span>         N &gt;<span class="token keyword">Int</span> <span class="token number">0</span>
    <span class="token keyword">rule</span> #replicateAux<span class="token punctuation">(</span> N<span class="token punctuation">,</span> _A<span class="token punctuation">,</span> WS <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> WS                                 <span class="token keyword">requires</span> notBool N &gt;<span class="token keyword">Int</span> <span class="token number">0</span>
</code></pre>
<ul>
<li><code>WordStack2List</code> converts a term of sort <code>WordStack</code> to a term of sort <code>List</code>.</li>
</ul>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> List <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> WordStack2List <span class="token punctuation">(</span> WordStack <span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> functional<span class="token punctuation">]</span>
 <span class="token comment">// -------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> WordStack2List<span class="token punctuation">(</span><span class="token punctuation">.</span>WordStack<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">.</span>List
    <span class="token keyword">rule</span> WordStack2List<span class="token punctuation">(</span>W <span class="token punctuation">:</span> WS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> ListItem<span class="token punctuation">(</span>W<span class="token punctuation">)</span> WordStack2List<span class="token punctuation">(</span>WS<span class="token punctuation">)</span>
</code></pre>
<h2 id="local-memory">Local Memory</h2>
<p>Most of EVM data is held in local memory.</p>
<ul>
<li><code>WM [ N := WS ]</code> assigns a contiguous chunk of <code>WM</code> to <code>WS</code> starting at position <code>W</code>.</li>
<li><code>#range(WM, START, WIDTH)</code> reads off <code>WIDTH</code> elements from <code>WM</code> beginning at position <code>START</code> (padding with zeros as needed).</li>
</ul>
<pre class="language-text"><code>    syntax Memory = Bytes
    syntax Memory ::= Memory &quot;[&quot; Int &quot;:=&quot; ByteArray &quot;]&quot; [function, functional, klabel(mapWriteBytes)]
 // -------------------------------------------------------------------------------------------------
    rule WS [ START := WS&apos; ] =&gt; replaceAtBytes(padRightBytes(WS, START +Int #sizeByteArray(WS&apos;), 0), START, WS&apos;) requires START &gt;=Int 0  [concrete]
    rule  _ [ START := _:ByteArray ] =&gt; .Memory                                                                  requires START  &lt;Int 0  [concrete]

    syntax ByteArray ::= #range ( Memory , Int , Int ) [function, functional]
 // -------------------------------------------------------------------------
    rule #range(LM, START, WIDTH) =&gt; LM [ START .. WIDTH ] [concrete]

    syntax Memory ::= &quot;.Memory&quot; [macro]
 // -----------------------------------
    rule .Memory =&gt; .Bytes

    syntax Memory ::= Memory &quot;[&quot; Int &quot;:=&quot; Int &quot;]&quot; [function]
 // --------------------------------------------------------
    rule WM [ IDX := VAL ] =&gt; padRightBytes(WM, IDX +Int 1, 0) [ IDX &lt;- VAL ]
</code></pre>
<pre class="language-text"><code>    syntax Memory = Map
    syntax Memory ::= Memory &quot;[&quot; Int &quot;:=&quot; ByteArray &quot;]&quot; [function, functional]
 // --------------------------------------------------------------------------
    rule [mapWriteBytes.base]:      WM[ _N := .WordStack ] =&gt; WM
    rule [mapWriteBytes.recursive]: WM[  N := W : WS     ] =&gt; (WM[N &lt;- W])[N +Int 1 := WS]

    syntax ByteArray ::= #range ( Memory , Int , Int )             [function, functional]
    syntax ByteArray ::= #range ( Memory , Int , Int , ByteArray ) [function, functional, klabel(#rangeAux)]
 // --------------------------------------------------------------------------------------------------------
    rule [#range]:         #range(WM, START, WIDTH) =&gt; #range(WM, START +Int WIDTH -Int 1, WIDTH, .WordStack)
    rule [#rangeAux.base]: #range( _,  _END, WIDTH, WS) =&gt; WS requires notBool 0 &lt;Int WIDTH
    rule [#rangeAux.rec]:  #range(WM,   END =&gt; END -Int 1, WIDTH =&gt; WIDTH -Int 1, WS =&gt; #lookupMemory(WM, END) : WS) requires 0 &lt;Int WIDTH

    syntax Memory ::= &quot;.Memory&quot; [macro]
 // -----------------------------------
    rule .Memory =&gt; .Map

    syntax Memory ::= Memory &quot;[&quot; Int &quot;:=&quot; Int &quot;]&quot; [function]
 // --------------------------------------------------------
    rule WM [ IDX := VAL:Int ] =&gt; WM [ IDX &lt;- VAL ]
</code></pre>
<h2 id="byte-arrays">Byte Arrays</h2>
<p>The local memory of execution is a byte-array (instead of a word-array).</p>
<ul>
<li><code>#asWord</code> will interperet a stack of bytes as a single word (with MSB first).</li>
<li><code>#asInteger</code> will interperet a stack of bytes as a single arbitrary-precision integer (with MSB first).</li>
<li><code>#asAccount</code> will interpret a stack of bytes as a single account id (with MSB first).
Differs from <code>#asWord</code> only in that an empty stack represents the empty account, not account zero.</li>
<li><code>#asByteStack</code> will split a single word up into a <code>ByteArray</code>.</li>
<li><code>_++_</code> acts as <code>ByteArray</code> append.</li>
<li><code>WS [ N .. W ]</code> access the range of <code>WS</code> beginning with <code>N</code> of width <code>W</code>.</li>
<li><code>#sizeByteArray</code> calculates the size of a <code>ByteArray</code>.</li>
<li><code>#padToWidth(N, WS)</code> and <code>#padRightToWidth</code> make sure that a <code>WordStack</code> is the correct size.</li>
</ul>
<pre class="language-text"><code>    syntax ByteArray = Bytes
    syntax ByteArray ::= &quot;.ByteArray&quot; [macro]
 // -----------------------------------------
    rule .ByteArray =&gt; .Bytes

    syntax Int ::= #asWord ( ByteArray ) [function, functional, smtlib(asWord)]
 // ---------------------------------------------------------------------------
    rule #asWord(WS) =&gt; chop(Bytes2Int(WS, BE, Unsigned)) [concrete]

    syntax Int ::= #asInteger ( ByteArray ) [function, functional]
 // --------------------------------------------------------------
    rule #asInteger(WS) =&gt; Bytes2Int(WS, BE, Unsigned) [concrete]

    syntax Account ::= #asAccount ( ByteArray ) [function]
 // ------------------------------------------------------
    rule #asAccount(BS) =&gt; .Account    requires lengthBytes(BS) ==Int 0
    rule #asAccount(BS) =&gt; #asWord(BS) [owise]

    syntax ByteArray ::= #asByteStack ( Int ) [function, functional]
 // ----------------------------------------------------------------
    rule #asByteStack(W) =&gt; Int2Bytes(W, BE, Unsigned) [concrete]

    syntax ByteArray ::= ByteArray &quot;++&quot; ByteArray [function, functional, right, klabel(_++_WS), smtlib(_plusWS_)]
 // -------------------------------------------------------------------------------------------------------------
    rule WS ++ WS&apos; =&gt; WS +Bytes WS&apos; [concrete]

    syntax ByteArray ::= ByteArray &quot;[&quot; Int &quot;..&quot; Int &quot;]&quot; [function, functional]
 // --------------------------------------------------------------------------
    rule                 _ [ START .. WIDTH ] =&gt; .ByteArray                      requires notBool (WIDTH &gt;=Int 0 andBool START &gt;=Int 0)
    rule [bytesRange] : WS [ START .. WIDTH ] =&gt; substrBytes(padRightBytes(WS, START +Int WIDTH, 0), START, START +Int WIDTH)
      requires WIDTH &gt;=Int 0 andBool START &gt;=Int 0 andBool START &lt;Int #sizeByteArray(WS)
    rule                 _ [ _     .. WIDTH ] =&gt; padRightBytes(.Bytes, WIDTH, 0) [owise]

    syntax Int ::= #sizeByteArray ( ByteArray ) [function, functional, klabel(sizeByteArray), smtlib(sizeByteArray)]
 // ----------------------------------------------------------------------------------------------------------------
    rule #sizeByteArray ( WS ) =&gt; lengthBytes(WS) [concrete]

    syntax ByteArray ::= #padToWidth      ( Int , ByteArray ) [function, functional]
                       | #padRightToWidth ( Int , ByteArray ) [function, functional]
 // --------------------------------------------------------------------------------
    rule                        #padToWidth(N, BS)      =&gt;               BS        requires notBool (N &gt;=Int 0)
    rule [padToWidthNonEmpty] : #padToWidth(N, BS)      =&gt;  padLeftBytes(BS, N, 0) requires          N &gt;=Int 0
    rule                        #padRightToWidth(N, BS) =&gt;               BS        requires notBool (N &gt;=Int 0)
    rule                        #padRightToWidth(N, BS) =&gt; padRightBytes(BS, N, 0) requires          N &gt;=Int 0
</code></pre>
<pre class="language-text"><code>    syntax ByteArray = WordStack
    syntax ByteArray ::= &quot;.ByteArray&quot; [macro]
 // -----------------------------------------
    rule .ByteArray =&gt; .WordStack

    syntax Int ::= #asWord ( ByteArray ) [function, functional, smtlib(asWord)]
 // ---------------------------------------------------------------------------
    rule [#asWord.base-empty]:  #asWord( .WordStack     ) =&gt; 0
    rule [#asWord.base-single]: #asWord( W : .WordStack ) =&gt; W
    rule [#asWord.recursive]:   #asWord( W0 : W1 : WS   ) =&gt; #asWord(((W0 *Word 256) +Word W1) : WS)

    syntax Int ::= #asInteger ( ByteArray ) [function]
 // --------------------------------------------------
    rule #asInteger( .WordStack     ) =&gt; 0
    rule #asInteger( W : .WordStack ) =&gt; W
    rule #asInteger( W0 : W1 : WS   ) =&gt; #asInteger(((W0 *Int 256) +Int W1) : WS)

    syntax Account ::= #asAccount ( ByteArray ) [function]
 // ------------------------------------------------------
    rule #asAccount( .WordStack ) =&gt; .Account
    rule #asAccount( W : WS     ) =&gt; #asWord(W : WS)

    syntax ByteArray ::= #asByteStack ( Int )             [function, functional]
                       | #asByteStack ( Int , ByteArray ) [function, klabel(#asByteStackAux), smtlib(asByteStack)]
 // --------------------------------------------------------------------------------------------------------------
    rule [#asByteStack]:              #asByteStack( W )      =&gt; #asByteStack( W , .WordStack )
    rule [#asByteStackAux.base]:      #asByteStack( 0 , WS ) =&gt; WS
    rule [#asByteStackAux.recursive]: #asByteStack( W , WS ) =&gt; #asByteStack( W /Int 256 , W modInt 256 : WS ) requires W =/=K 0

    syntax ByteArray ::= ByteArray &quot;++&quot; ByteArray [function, memo, right, klabel(_++_WS), smtlib(_plusWS_)]
 // -------------------------------------------------------------------------------------------------------
    rule .WordStack ++ WS&apos; =&gt; WS&apos;
    rule (W : WS)   ++ WS&apos; =&gt; W : (WS ++ WS&apos;)

    syntax ByteArray ::= ByteArray &quot;[&quot; Int &quot;..&quot; Int &quot;]&quot; [function, functional, memo]
 // --------------------------------------------------------------------------------
    rule [ByteArray.range]: WS [ START .. WIDTH ] =&gt; #take(WIDTH, #drop(START, WS))

    syntax Int ::= #sizeByteArray ( ByteArray ) [function, functional, smtlib(sizeByteArray), memo]
 // -----------------------------------------------------------------------------------------------
    rule #sizeByteArray ( WS ) =&gt; #sizeWordStack(WS) [concrete]

    syntax ByteArray ::= #padToWidth      ( Int , ByteArray ) [function, functional, memo]
                       | #padRightToWidth ( Int , ByteArray ) [function, memo]
 // --------------------------------------------------------------------------------------
    rule [#padToWidth]:      #padToWidth(N, WS)      =&gt; #replicateAux(N -Int #sizeByteArray(WS), 0, WS)
    rule [#padRightToWidth]: #padRightToWidth(N, WS) =&gt; WS ++ #replicate(N -Int #sizeByteArray(WS), 0)
</code></pre>
<h2 id="accounts">Accounts</h2>
<h3 id="empty-account">Empty Account</h3>
<ul>
<li><code>.Account</code> represents the case when an account ID is referenced in the yellowpaper, but
the actual value of the account ID is the empty set. This is used, for example, when
referring to the destination of a message which creates a new contract.</li>
</ul>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> Account <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;.Account&quot;</span> <span class="token operator">|</span> <span class="token keyword">Int</span>
 <span class="token comment">// -----------------------------------</span>
</code></pre>
<h3 id="addresses">Addresses</h3>
<ul>
<li><code>#addr</code> turns an Ethereum word into the corresponding Ethereum address (160 LSB).</li>
</ul>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> <span class="token keyword">Int</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #addr <span class="token punctuation">(</span> <span class="token keyword">Int</span> <span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
 <span class="token comment">// ---------------------------------------</span>
    <span class="token keyword">rule</span> #addr<span class="token punctuation">(</span>W<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> W <span class="token operator">%</span>Word pow160
</code></pre>
<h2 id="storage%2Fmemory-lookup">Storage/Memory Lookup</h2>
<p><code>#lookup*</code> looks up a key in a map and returns 0 if the key doesn&apos;t exist, otherwise returning its value.</p>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> <span class="token keyword">Int</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #lookup        <span class="token punctuation">(</span> Map <span class="token punctuation">,</span> <span class="token keyword">Int</span> <span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> functional<span class="token punctuation">,</span> smtlib<span class="token punctuation">(</span>lookup<span class="token punctuation">)</span><span class="token punctuation">]</span>
                 <span class="token operator">|</span> #lookupMemory  <span class="token punctuation">(</span> Map <span class="token punctuation">,</span> <span class="token keyword">Int</span> <span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> functional<span class="token punctuation">,</span> smtlib<span class="token punctuation">(</span>lookupMemory<span class="token punctuation">)</span><span class="token punctuation">]</span>
 <span class="token comment">// ----------------------------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> <span class="token punctuation">[</span>#lookup<span class="token punctuation">.</span>some<span class="token punctuation">]</span><span class="token punctuation">:</span>         #lookup<span class="token punctuation">(</span>       <span class="token punctuation">(</span>KEY <span class="token operator">|</span><span class="token operator">-</span>&gt; VAL<span class="token punctuation">:</span><span class="token keyword">Int</span><span class="token punctuation">)</span> _M<span class="token punctuation">,</span> KEY <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> VAL modInt pow256
    <span class="token keyword">rule</span> <span class="token punctuation">[</span>#lookup<span class="token punctuation">.</span>none<span class="token punctuation">]</span><span class="token punctuation">:</span>         #lookup<span class="token punctuation">(</span>                          M<span class="token punctuation">,</span> KEY <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token number">0</span>                 <span class="token keyword">requires</span> notBool KEY in_keys<span class="token punctuation">(</span>M<span class="token punctuation">)</span>
    <span class="token comment">//Impossible case, for completeness</span>
    <span class="token keyword">rule</span> <span class="token punctuation">[</span>#lookup<span class="token punctuation">.</span>notInt<span class="token punctuation">]</span><span class="token punctuation">:</span>       #lookup<span class="token punctuation">(</span>       <span class="token punctuation">(</span>KEY <span class="token operator">|</span><span class="token operator">-</span>&gt; VAL    <span class="token punctuation">)</span> _M<span class="token punctuation">,</span> KEY <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token number">0</span>                 <span class="token keyword">requires</span> notBool isInt<span class="token punctuation">(</span>VAL<span class="token punctuation">)</span>

    <span class="token keyword">rule</span> <span class="token punctuation">[</span>#lookupMemory<span class="token punctuation">.</span>some<span class="token punctuation">]</span><span class="token punctuation">:</span>   #lookupMemory<span class="token punctuation">(</span> <span class="token punctuation">(</span>KEY <span class="token operator">|</span><span class="token operator">-</span>&gt; VAL<span class="token punctuation">:</span><span class="token keyword">Int</span><span class="token punctuation">)</span> _M<span class="token punctuation">,</span> KEY <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> VAL modInt <span class="token number">256</span>
    <span class="token keyword">rule</span> <span class="token punctuation">[</span>#lookupMemory<span class="token punctuation">.</span>none<span class="token punctuation">]</span><span class="token punctuation">:</span>   #lookupMemory<span class="token punctuation">(</span>                    M<span class="token punctuation">,</span> KEY <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token number">0</span>                 <span class="token keyword">requires</span> notBool KEY in_keys<span class="token punctuation">(</span>M<span class="token punctuation">)</span>
    <span class="token comment">//Impossible case, for completeness</span>
    <span class="token keyword">rule</span> <span class="token punctuation">[</span>#lookupMemory<span class="token punctuation">.</span>notInt<span class="token punctuation">]</span><span class="token punctuation">:</span> #lookupMemory<span class="token punctuation">(</span> <span class="token punctuation">(</span>KEY <span class="token operator">|</span><span class="token operator">-</span>&gt; VAL    <span class="token punctuation">)</span> _M<span class="token punctuation">,</span> KEY <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token number">0</span>                 <span class="token keyword">requires</span> notBool isInt<span class="token punctuation">(</span>VAL<span class="token punctuation">)</span>
</code></pre>
<h2 id="substate-log">Substate Log</h2>
<p>During execution of a transaction some things are recorded in the substate log (Section 6.1 in YellowPaper).
This is a right cons-list of <code>SubstateLogEntry</code> (which contains the account ID along with the specified portions of the <code>wordStack</code> and <code>localMem</code>).</p>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> SubstateLogEntry <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;{&quot;</span> <span class="token keyword">Int</span> <span class="token string">&quot;|&quot;</span> List <span class="token string">&quot;|&quot;</span> ByteArray <span class="token string">&quot;}&quot;</span> <span class="token punctuation">[</span><span class="token class-name">klabel</span><span class="token punctuation">(</span>logEntry<span class="token punctuation">)</span><span class="token punctuation">]</span>
 <span class="token comment">// ---------------------------------------------------------------------------------</span>
</code></pre>
<pre class="language-k"><code><span class="token keyword">endmodule</span>
</code></pre>
</body></html></div>
        </main>

        <!-- Page ToC -->
        <div class="col-12 col-md-3 col-xl-2 py-md-3 bd-sidebar page-toc mb-3">
          
<div>
<details style="padding:0.25rem 0;;padding-left: 0px;" open>
            <summary class="bd-toc-link-wrapper">
              <a href="#data-structures-over-word" class="bd-toc-link">Data-Structures over <code>Word</code></a>
              </summary>
            <div>
              <details style="padding:0.25rem 0;;padding-left: 8px;" open>
            <summary class="bd-toc-link-wrapper">
              <a href="#utilities" class="bd-toc-link">Utilities</a>
              </summary>
            <div>
              <div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#important-powers"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                Important Powers
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#boolean-conversions"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                Boolean Conversions
              </a></div>
            </div>
          </details>
        <details style="padding:0.25rem 0;;padding-left: 8px;" open>
            <summary class="bd-toc-link-wrapper">
              <a href="#word-operations" class="bd-toc-link">Word Operations</a>
              </summary>
            <div>
              <div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#low-level"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                Low-Level
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#word-comparison"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                Word Comparison
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#bitwise-operators"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                Bitwise Operators
              </a></div>
            </div>
          </details>
        <details style="padding:0.25rem 0;;padding-left: 8px;" open>
            <summary class="bd-toc-link-wrapper">
              <a href="#a-wordstack-for-evm" class="bd-toc-link">A WordStack for EVM</a>
              </summary>
            <div>
              <div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#as-a-cons-list"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                As a cons-list
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#element-access"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                Element Access
              </a></div>
            </div>
          </details>
        <div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#local-memory"
                class="bd-toc-link"
                style="padding-left: 8px;;"
              >
                Local Memory
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#byte-arrays"
                class="bd-toc-link"
                style="padding-left: 8px;;"
              >
                Byte Arrays
              </a></div><details style="padding:0.25rem 0;;padding-left: 8px;" open>
            <summary class="bd-toc-link-wrapper">
              <a href="#accounts" class="bd-toc-link">Accounts</a>
              </summary>
            <div>
              <div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#empty-account"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                Empty Account
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#addresses"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                Addresses
              </a></div>
            </div>
          </details>
        <div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#storage%2Fmemory-lookup"
                class="bd-toc-link"
                style="padding-left: 8px;;"
              >
                Storage/Memory Lookup
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#substate-log"
                class="bd-toc-link"
                style="padding-left: 8px;;"
              >
                Substate Log
              </a></div>
            </div>
          </details>
        
</div>

        </div>
        <div class="btn btn-rv-blue page-toc-toggle-btn"></div>
        <!-- End Page ToC -->
      </div>
    </div>
<!-- The footer is now controlled by the k-web-theme git submodule -->
<footer id="rvsite-footer" class="app-footer text-md-left text-center">
  <div class="container">
    <div class="row align-items-center">
      <div class="col-md-4 mb-md-0 mb-4">
        <a href="https://runtimeverification.com/" target="_blank">
          <picture>
            <source
              srcset="
                https://runtimeverification.com/assets/img/rv-logo-dark.png
              "
              media="(prefers-color-scheme: dark)"
            />
            <img
              class="logo-dark"
              src="https://runtimeverification.com/assets/img/rv-logo.png"
              alt="Runtime Verification logo"
              style="height: 32px"
            /> </picture
        ></a>
        <p class="mt-2 text-md-left copyright">
          <a href="https://goo.gl/maps/NYzr2iKpXMgEmQ2F6" target="_blank"
            >102 E Main St #500, Urbana, IL 61801</a
          >
        </p>
      </div>
      <div class="col-md-4 text-md-center mb-md-0 mb-4"></div>
      <div class="col-md-4 mb-md-0 mb-4 text-md-right">
        <p class="copyright">2022 © all rights reserved</p>
      </div>
    </div>
  </div>
</footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/Typist/1.2/typist.min.js"></script>
    <script src="../assets/js/index.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script
  async
  src="https://www.googletagmanager.com/gtag/js?id=G-QL0D8HRYFW"
></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag() {
    dataLayer.push(arguments);
  }
  gtag("js", new Date());
  gtag("config", "G-QL0D8HRYFW");
</script>

  </body>
</html>
